System.register(["./json-asset-1f2be75e.js","./index-a996f499.js","./sprite-frame-9016d268.js","./sprite-dc4183cc.js","./renderable-2d-549948c8.js","./graphics-3f37ca15.js","./vertex-format-eb40922d.js","./deprecated-63c84b47.js","./deprecated-4eee0a13.js"],(function(t){"use strict";var e,r,a,i,n,s,o,h,u,c,l,f,d,v,p,_,x,g,y,m,S,D,w,B,C,M,b,T,F,L,A,R,E,P,O,H,I,N,k,z,V,U,W,Z,q,G,X,j,K,Q,J,Y,$,tt,et,rt,at,it,nt,st,ot;return{setters:[function(t){e=t.c5,r=t.cc,a=t.cj,i=t.ch,n=t.cf,s=t.c3,o=t.fN,h=t.fv,u=t.V,c=t.l,l=t.t,f=t.c,d=t.f,v=t.dA,p=t.e1,_=t.e7,x=t.gF,g=t.aU,y=t.R,m=t.dq,S=t.C,D=t.P,w=t.aq,B=t.z,C=t.G,M=t.d},function(t){b=t.s,T=t.t},function(t){F=t.d,L=t.S},function(t){A=t.h,R=t.O,E=t.e,P=t.i,O=t.H,H=t.V,I=t.j,N=t.k,k=t.c,z=t.s,V=t.f,U=t.d,W=t.g,Z=t.B,q=t.a,G=t.T},function(t){X=t.S,j=t.a},function(t){K=t.L,Q=t.a,J=t.P,Y=t.b,$=t.G},function(t){tt=t.c,et=t.g},function(t){rt=t.L,at=t.c,it=t.a,nt=t.e,st=t.M,ot=t.D},function(){}],execute:function(){t("e",Rt);var ht=new e,ut=new r;function ct(t,r,i,n){var s=i.data,o=r.acquireBufferBatch(),h=o.byteOffset>>2,u=i.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(u,i.indicesCount)||(o=r.currBufferBatch,h=0,c=0,l=0);var f=o.vData,d=o.iData;t.getWorldMatrix(ut);for(var v=0;v<u;v++){var p=s[v];e.set(ht,p.x,p.y,0),e.transformMat4(ht,ht,ut),f[h++]=ht.x,f[h++]=ht.y,f[h++]=ht.z,f[h++]=p.u,f[h++]=p.v,a.toArray(f,n,h),h+=4}for(var _=0,x=u/4;_<x;_++){var g=l+4*_;d[c++]=g,d[c++]=g+1,d[c++]=g+2,d[c++]=g+1,d[c++]=g+3,d[c++]=g+2}}var lt=function(t,e,r){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=r};function ft(t,e,r,a,i){var n=0,s=null;if(i===function(t,e,r,a){for(var i=0,n=e,s=r-a;n<r;n+=a)i+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return i}(t,e,r,a)>0)for(n=e;n<r;n+=a)s=Lt(n,t[n],t[n+1],s);else for(n=r-a;n>=e;n-=a)s=Lt(n,t[n],t[n+1],s);return s&&Mt(s,s.next)&&(At(s),s=s.next),s}function dt(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var r=t,a=!1;do{if(a=!1,r.steiner||!Mt(r,r.next)&&0!==Ct(r.prev,r,r.next))r=r.next;else{if(At(r),(r=e=r.prev)===r.next)return null;a=!0}}while(a||r!==e);return e}function vt(t,e,r,a,i,n,s){if(void 0===s&&(s=0),t){!s&&n&&function(t,e,r,a){var i=t;do{null===i.z&&(i.z=St(i.x,i.y,e,r,a)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e=0,r=null,a=null,i=null,n=null,s=0,o=0,h=0,u=1;do{for(r=t,t=null,n=null,s=0;r;){for(s++,a=r,o=0,e=0;e<u&&(o++,a=a.nextZ);e++);for(h=u;o>0||h>0&&a;)0===o?(i=a,a=a.nextZ,h--):0!==h&&a?r.z<=a.z?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,h--):(i=r,r=r.nextZ,o--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;r=a}n.nextZ=null,u*=2}while(s>1)}(i)}(t,a,i,n);for(var o=t,h=null,u=null;t.prev!==t.next;)if(h=t.prev,u=t.next,n?_t(t,a,i,n):pt(t))e.push(h.i/r),e.push(t.i/r),e.push(u.i/r),At(t),t=u.next,o=u.next;else if((t=u)===o){s?1===s?vt(t=xt(t,e,r),e,r,a,i,n,2):2===s&&gt(t,e,r,a,i,n):vt(dt(t),e,r,a,i,n,1);break}}}function pt(t){var e=t.prev,r=t,a=t.next;if(Ct(e,r,a)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(wt(e.x,e.y,r.x,r.y,a.x,a.y,i.x,i.y)&&Ct(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function _t(t,e,r,a){var i=t.prev,n=t,s=t.next;if(Ct(i,n,s)>=0)return!1;for(var o=i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,h=i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,u=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,c=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,l=St(o,h,e,r,a),f=St(u,c,e,r,a),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&wt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Ct(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=l;){if(d!==t.prev&&d!==t.next&&wt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Ct(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function xt(t,e,r){var a=t;do{var i=a.prev,n=a.next.next;!Mt(i,n)&&bt(i,a,a.next,n)&&Tt(i,n)&&Tt(n,i)&&(e.push(i.i/r),e.push(a.i/r),e.push(n.i/r),At(a),At(a.next),a=t=n),a=a.next}while(a!==t);return a}function gt(t,e,r,a,i,n){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Bt(s,o)){var h=Ft(s,o);return s=dt(s,s.next),h=dt(h,h.next),vt(s,e,r,a,i,n),void vt(h,e,r,a,i,n)}o=o.next}s=s.next}while(s!==t)}function yt(t,e){return t.x-e.x}function mt(t,e){if(e=function(t,e){var r=e,a=t.x,i=t.y,n=-1/0,s=null;do{if(i<=r.y&&i>=r.next.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=a&&o>n){if(n=o,o===a){if(i===r.y)return r;if(i===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(a===n)return s.prev;var h,u=s,c=s.x,l=s.y,f=1/0;for(r=s.next;r!==u;)a>=r.x&&r.x>=c&&wt(i<l?a:n,i,c,l,i<l?n:a,i,r.x,r.y)&&((h=Math.abs(i-r.y)/(a-r.x))<f||h===f&&r.x>s.x)&&Tt(r,t)&&(s=r,f=h),r=r.next;return s}(t,e)){var r=Ft(e,t);dt(r,r.next)}}function St(t,e,r,a,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)/i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Dt(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function wt(t,e,r,a,i,n,s,o){return(i-s)*(e-o)-(t-s)*(n-o)>=0&&(t-s)*(a-o)-(r-s)*(e-o)>=0&&(r-s)*(n-o)-(i-s)*(a-o)>=0}function Bt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&bt(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Tt(t,e)&&Tt(e,t)&&function(t,e){var r=t,a=!1,i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(a=!a),r=r.next}while(r!==t);return a}(t,e)}function Ct(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Mt(t,e){return t.x===e.x&&t.y===e.y}function bt(t,e,r,a){return!!(Mt(t,e)&&Mt(r,a)||Mt(t,a)&&Mt(r,e))||Ct(t,e,r)>0!=Ct(t,e,a)>0&&Ct(r,a,t)>0!=Ct(r,a,e)>0}function Tt(t,e){return Ct(t.prev,t,t.next)<0?Ct(t,e,t.next)>=0&&Ct(t,t.prev,e)>=0:Ct(t,e,t.prev)<0||Ct(t,t.next,e)<0}function Ft(t,e){var r=new lt(t.i,t.x,t.y),a=new lt(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,a.next=r,r.prev=a,n.next=a,a.prev=n,a}function Lt(t,e,r,a){var i=new lt(t,e,r);return a?(i.next=a.next,i.prev=a,a.next.prev=i,a.next=i):(i.prev=i,i.next=i),i}function At(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rt(t,e,r){r=r||3;var a=e?e.length:0,i=a?e[0]*r:t.length,n=ft(t,0,i,r,!0),s=[];if(!n)return s;var o=0,h=0,u=0,c=0,l=0,f=0,d=0;if(a&&(n=function(t,e,r,a){var i,n=[],s=0,o=null;for(s=0,i=e.length;s<i;s++)(o=ft(t,e[s]*a,s<i-1?e[s+1]*a:t.length,a,!1))&&(o===o.next&&(o.steiner=!0),n.push(Dt(o)));if(n.sort(yt),!r)return r;for(s=0;s<n.length;s++)mt(n[s],r),r=dt(r,r.next);return r}(t,e,n,r)),t.length>80*r){o=u=t[0],h=c=t[1];for(var v=r;v<i;v+=r)(l=t[v])<o&&(o=l),(f=t[v+1])<h&&(h=f),l>u&&(u=l),f>c&&(c=f);d=Math.max(u-o,c-h)}return vt(n,s,r,o,h,d),s}for(var Et=Math.PI,Pt=Math.min,Ot=Math.max,Ht=Math.ceil,It=Math.acos,Nt=Math.cos,kt=Math.sin,zt=Math.atan2,Vt=null,Ut=null,Wt=new a,Zt=[],qt=0;qt<4;qt++)Zt.push(new e);function Gt(t,e,r){return t<e?e:t>r?r:t}var Xt={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!Ut)return null;var r=Ut.getRenderDataList(),a=r[Ut.dataOffset];if(!a)return null;var i=a,n=i?i.vertexStart+e:0;return(n>65535||3*n>131070)&&(++Ut.dataOffset,Ut.dataOffset<r.length?a=r[Ut.dataOffset]:(a=Ut.requestRenderData(),r[Ut.dataOffset]=a),i=a),i&&i.vertexCount<n&&i.request(e,3*e),a},stroke:function(t){a.copy(Wt,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){a.copy(Wt,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,r=t.lineCap,a=t.lineJoin,i=t.miterLimit;if(Ut=t.impl){var n,s,o,h,u=(n=e,s=Et,o=Ut.tessTol,h=2*It(n/(n+o)),Ot(2,Ht(s/h)));this._calculateJoins(Ut,e,a,i);for(var c=Ut.paths,l=0,f=Ut.pathOffset,d=Ut.pathLength;f<d;f++){var v=c[f],p=v.points.length;a===K.ROUND?l+=2*(p+v.bevel*(u+2)+1):l+=2*(p+5*v.bevel+1),v.closed||(r===Q.ROUND?l+=2*(2*u+2):l+=12)}var _=Vt=this.getRenderData(t,l);if(_){for(var x=_.vData,g=_.iData,y=Ut.pathOffset,m=Ut.pathLength;y<m;y++){var S=c[y],D=S.points,w=D.length,B=_.vertexStart,C=void 0,M=void 0,b=0,T=0,F=S.closed;if(F?(C=D[w-1],M=D[0],b=0,T=w):(C=D[0],M=D[1],b=1,T=w-1),M=M||C,!F){var L=new J(M.x,M.y);L.subtract(C),L.normalize();var A=L.x,R=L.y;r===Q.BUTT?this._buttCapStart(C,A,R,e,0):r===Q.SQUARE?this._buttCapStart(C,A,R,e,e):r===Q.ROUND&&this._roundCapStart(C,A,R,e,u)}for(var E=b;E<T;++E)a===K.ROUND?this._roundJoin(C,M,e,e,u):0!=(M.flags&(Y.PT_BEVEL|Y.PT_INNERBEVEL))?this._bevelJoin(C,M,e,e):(this._vSet(M.x+M.dmx*e,M.y+M.dmy*e,1),this._vSet(M.x-M.dmx*e,M.y-M.dmy*e,-1)),C=M,M=D[E+1];if(F){var P=8*B;this._vSet(x[P],x[P+1],1),this._vSet(x[P+8],x[P+8+1],-1)}else{var O=new J(M.x,M.y);O.subtract(C),O.normalize();var H=O.x,I=O.y;r===Q.BUTT?this._buttCapEnd(M,H,I,e,0):r===Q.SQUARE?this._buttCapEnd(M,H,I,e,e):r===Q.ROUND&&this._roundCapEnd(M,H,I,e,u)}for(var N=_.indicesStart,k=B+2,z=_.vertexStart;k<z;k++)g[N++]=k-2,g[N++]=k-1,g[N++]=k;_.indicesStart=N}Vt=null,Ut=null}}},_expandFill:function(t){if(Ut=t.impl){for(var e=Ut.paths,r=0,a=Ut.pathOffset,i=Ut.pathLength;a<i;a++)r+=e[a].points.length;var n=Vt=this.getRenderData(t,r);if(n){for(var s=n,o=s.vData,h=s.iData,u=Ut.pathOffset,c=Ut.pathLength;u<c;u++){var l=e[u],f=l.points,d=f.length;if(0!==d){for(var v=n.vertexStart,p=0;p<d;++p)this._vSet(f[p].x,f[p].y);var _=n.indicesStart;if(l.complex){for(var x=[],g=v,y=n.vertexStart;g<y;g++){var m=8*g;x.push(o[m++]),x.push(o[m++]),x.push(o[m++])}var S=Rt(x,null,3);if(!S||0===S.length)continue;for(var D=0,w=S.length;D<w;D++)h[_++]=S[D]+v}else for(var B=v,C=v+2,M=s.vertexStart;C<M;C++)h[_++]=B,h[_++]=C-1,h[_++]=C;s.indicesStart=_}}Vt=null,Ut=null}}},_calculateJoins:function(t,e,r,a){var i=0;e>0&&(i=1/e);for(var n=t.paths,s=t.pathOffset,o=t.pathLength;s<o;s++){var h=n[s],u=h.points,c=u.length,l=u[c-1],f=u[0];h.bevel=0;for(var d=0;d<c;d++){var v,p,_=l.dy,x=-l.dx,g=f.dy,y=-f.dx;if(f.dmx=.5*(_+g),f.dmy=.5*(x+y),(v=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var m=1/v;m>600&&(m=600),f.dmx*=m,f.dmy*=m}f.dx*l.dy-l.dx*f.dy>0&&(f.flags|=Y.PT_LEFT),v*(p=Ot(11,Pt(l.len,f.len)*i))*p<1&&(f.flags|=Y.PT_INNERBEVEL),f.flags&Y.PT_CORNER&&(v*a*a<1||r===K.BEVEL||r===K.ROUND)&&(f.flags|=Y.PT_BEVEL),0!=(f.flags&(Y.PT_BEVEL|Y.PT_INNERBEVEL))&&h.bevel++,l=f,f=u[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,r=t.pathOffset,a=t.pathLength;r<a;r++){var i=e[r],n=i.points,s=n[n.length-1],o=n[0];n.length>2&&s.equals(o)&&(i.closed=!0,n.pop(),s=n[n.length-1]);for(var h=0,u=n.length;h<u;h++){var c=new J(o.x,o.y);c.subtract(s),s.len=c.length(),(c.x||c.y)&&c.normalize(),s.dx=c.x,s.dy=c.y,s=o,o=n[h+1]}}},_chooseBevel:function(t,e,r,a){var i=r.x,n=r.y,s=0,o=0,h=0,u=0;return 0!==t?(s=i+e.dy*a,o=n-e.dx*a,h=i+r.dy*a,u=n-r.dx*a):(s=h=i+r.dmx*a,o=u=n+r.dmy*a),[s,o,h,u]},_buttCapStart:function(t,e,r,a,i){var n=t.x-e*i,s=t.y-r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_buttCapEnd:function(t,e,r,a,i){var n=t.x+e*i,s=t.y+r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapStart:function(t,e,r,a,i){for(var n=t.x,s=t.y,o=r,h=-e,u=0;u<i;u++){var c=u/(i-1)*Et,l=Nt(c)*a,f=kt(c)*a;this._vSet(n-o*l-e*f,s-h*l-r*f,1),this._vSet(n,s,0)}this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapEnd:function(t,e,r,a,i){var n=t.x,s=t.y,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1);for(var u=0;u<i;u++){var c=u/(i-1)*Et,l=Nt(c)*a,f=kt(c)*a;this._vSet(n,s,0),this._vSet(n-o*l+e*f,s-h*l+r*f,1)}},_roundJoin:function(t,e,r,a,i){var n=t.dy,s=-t.dx,o=e.dy,h=-e.dx,u=e.x,c=e.y;if(0!=(e.flags&Y.PT_LEFT)){var l=this._chooseBevel(e.flags&Y.PT_INNERBEVEL,t,e,r),f=l[0],d=l[1],v=l[2],p=l[3],_=zt(-s,-n),x=zt(-h,-o);x>_&&(x-=2*Et),this._vSet(f,d,1),this._vSet(u-n*a,e.y-s*a,-1);for(var g=Gt(Ht((_-x)/Et)*i,2,i),y=0;y<g;y++){var m=_+y/(g-1)*(x-_),S=u+Nt(m)*a,D=c+kt(m)*a;this._vSet(u,c,0),this._vSet(S,D,-1)}this._vSet(v,p,1),this._vSet(u-o*a,c-h*a,-1)}else{var w=this._chooseBevel(e.flags&Y.PT_INNERBEVEL,t,e,-a),B=w[0],C=w[1],M=w[2],b=w[3],T=zt(s,n),F=zt(h,o);F<T&&(F+=2*Et),this._vSet(u+n*a,c+s*a,1),this._vSet(B,C,-1);for(var L=Gt(Ht((F-T)/Et)*i,2,i),A=0;A<L;A++){var R=T+A/(L-1)*(F-T),E=u+Nt(R)*r,P=c+kt(R)*r;this._vSet(E,P,1),this._vSet(u,c,0)}this._vSet(u+o*a,c+h*a,1),this._vSet(M,b,-1)}},_bevelJoin:function(t,e,r,a){var i=0,n=0,s=0,o=0,h=0,u=0,c=0,l=0,f=t.dy,d=-t.dx,v=e.dy,p=-e.dx;if(e.flags&Y.PT_LEFT){var _=this._chooseBevel(e.flags&Y.PT_INNERBEVEL,t,e,r);h=_[0],u=_[1],c=_[2],l=_[3],this._vSet(h,u,1),this._vSet(e.x-f*a,e.y-d*a,-1),this._vSet(c,l,1),this._vSet(e.x-v*a,e.y-p*a,-1)}else{var x=this._chooseBevel(e.flags&Y.PT_INNERBEVEL,t,e,-a);i=x[0],n=x[1],s=x[2],o=x[3],this._vSet(e.x+f*r,e.y+d*r,1),this._vSet(i,n,-1),this._vSet(e.x+v*r,e.y+p*r,1),this._vSet(s,o,-1)}},_vSet:function(t,e,r){if(void 0===r&&(r=0),Vt){var i=Vt,n=8*i.vertexStart,s=i.vData;s[n++]=t,s[n++]=e,s[n++]=0,a.toArray(s,Wt,n),n+=4,s[n++]=r,i.vertexStart++}}},jt=t("g",{getAssembler:function(){return Xt}});$.Assembler=jt;var Kt=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},Qt=new i,Jt=null,Yt=null,$t=[],te=[],ee=[],re=[],ae=new n,ie=new n,ne=new s,se=null,oe=0,he=0,ue=0,ce=0,le=0,fe=1,de=null,ve="",pe=0,_e=0,xe=0,ge=0,ye=0,me=0,Se=0,De=!1,we=0,Be=0,Ce=0,Me={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&Jt!==t&&(Yt=(Jt=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),Jt.actualFontSize=pe,Yt.setContentSize(ie),Jt.renderData.vertDirty=Jt.renderData.uvDirty=!1,Jt.markForUpdateRenderData(!1),Jt=null,this._resetProperties())},_updateFontScale:function(){fe=pe/_e},_updateFontFamily:function(t){var e=t.font;de=e.spriteFrame,se=e.fntConfig,A.fontAtlas=e.fontDefDictionary,F.packToDynamicAtlas(t,de)},_updateLabelInfo:function(){A.hash="",A.margin=0},_updateProperties:function(t){ve=t.string.toString(),pe=t.fontSize,_e=se?se.fontSize:t.fontSize,xe=t.horizontalAlign,ge=t.verticalAlign,ye=t.spacingX,Se=t.overflow,me=t._lineHeight;var e=Yt.contentSize;ie.width=e.width,ie.height=e.height,Se===R.NONE?(De=!1,ie.width+=2*A.margin,ie.height+=2*A.margin):Se===R.RESIZE_HEIGHT?(De=!0,ie.height+=2*A.margin):De=t.enableWrapText,A.lineHeight=me,A.fontSize=pe,this._setupBMFontOverflowMetrics()},_resetProperties:function(){se=null,de=null,A.hash="",A.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=ve,e=t.length,r=se.kerningDict,a=$t,i=-1,n=0;n<e;++n){var s=t.charCodeAt(n),o=r[i<<16|65535&s]||0;a[n]=n<e-1?o:0,i=s}},_multilineTextWrap:function(t){for(var e=ve.length,r=0,a=0,i=0,n=0,s=0,o=0,h=0,u=null,c=0;c<e;){var l=ve.charAt(c);if("\n"!==l){for(var f=t(ve,c,e),d=o,v=h,p=s,_=a,x=!1,g=0;g<f;++g){var y=c+g;if("\r"!==(l=ve.charAt(y)))if(u=A.fontAtlas.getLetterDefinitionForChar(l,A)){var m=_+u.offsetX*fe-A.margin;if(De&&Ce>0&&a>0&&m+u.w*fe>Ce&&!E(l)){ee.push(s),s=0,r++,a=0,i-=me*this._getFontScale()+0,x=!0;break}ne.x=m,ne.y=i-u.offsetY*fe,this._recordLetterInfo(ne,l,y,r),y+1<$t.length&&y<e-1&&(_+=$t[y+1]),_+=u.xAdvance*fe+ye,p=ne.x+u.w*fe,d<ne.y&&(d=ne.y),v>ne.y-u.h*fe&&(v=ne.y-u.h*fe)}else this._recordPlaceholderInfo(y,l),console.log("Can't find letter definition in texture atlas "+se.atlasName+" for letter:"+l);else this._recordPlaceholderInfo(y,l)}x||(a=_,o<d&&(o=d),h>v&&(h=v),n<(s=p)&&(n=s),c+=f)}else ee.push(s),s=0,r++,a=0,i-=me*this._getFontScale()+0,this._recordPlaceholderInfo(c,l),c++}return ee.push(s),he=(oe=r+1)*me*this._getFontScale(),oe>1&&(he+=0*(oe-1)),ie.width=we,ie.height=Be,we<=0&&(ie.width=parseFloat(n.toFixed(2))+2*A.margin),Be<=0&&(ie.height=parseFloat(he.toFixed(2))+2*A.margin),ce=ie.height,le=0,o>0&&(ce=ie.height+o),h<-he&&(le=he+h),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return Se===R.SHRINK?fe:1},_getFirstWordLen:function(t,e,r){var a=t.charAt(e);if(P(a)||"\n"===a||E(a))return 1;var i=1,n=A.fontAtlas.getLetterDefinitionForChar(a,A);if(!n)return i;for(var s=n.xAdvance*fe+ye,o=e+1;o<r&&(a=t.charAt(o),n=A.fontAtlas.getLetterDefinitionForChar(a,A));++o){if(s+n.offsetX*fe+n.w*fe>Ce&&!E(a)&&Ce>0)return i;if(s+=n.xAdvance*fe+ye,"\n"===a||E(a)||P(a))break;i++}return i},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=te.length){var r=new Kt;te.push(r)}te[t].char=e,te[t].hash=e.charCodeAt(0)+A.hash,te[t].valid=!1},_recordLetterInfo:function(t,e,r,a){if(r>=te.length){var i=new Kt;te.push(i)}var n=e.charCodeAt(0)+A.hash;te[r].line=a,te[r].char=e,te[r].hash=n,te[r].valid=A.fontAtlas.getLetter(n).valid,te[r].x=t.x,te[r].y=t.y},_alignText:function(){he=0,ee.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),Se===R.SHRINK&&pe>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||Se===R.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),pe=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,r=0|pe,a=0;e<r;){var i=a=e+r+1>>1;if(i<=0)break;fe=i/_e,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?r=a-1:e=a}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return he>ie.height},_isHorizontalClamp:function(){for(var t=!1,e=0,r=ve.length;e<r;++e){var a=te[e];if(a.valid){var i=A.fontAtlas.getLetterDefinitionForChar(a.char,A);if(!i)continue;var n=a.x+i.w/2*fe,s=a.line;if(we>0)if(De){if(ee[s]>ie.width&&(n>ie.width||n<0)){t=!0;break}}else if(n>ie.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var r=ee[e],a=t>ie.width||t<0;return De?r>ie.width&&a:a},_updateQuads:function(){if(!Jt)return!1;var t=de?de.texture:A.fontAtlas.getTexture(),e=Jt.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var r=Yt.anchorPoint,a=ie,i=r.x*a.width,n=r.y*a.height,s=!0,o=0,h=ve.length;o<h;++o){var u=te[o];if(u.valid){var c=A.fontAtlas.getLetter(u.hash);if(c){Qt.height=c.h,Qt.width=c.w,Qt.x=c.u,Qt.y=c.v;var l=u.y+ue;if(Be>0){if(l>ce){var f=l-ce;Qt.y+=f,Qt.height-=f,l-=f}l-c.h*fe<le&&Se===R.CLAMP&&(Qt.height=l<le?0:(l-le)/fe)}var d=u.line,v=u.x+c.w/2*fe+re[d];if(we>0&&this._isHorizontalClamped(v,d))if(Se===R.CLAMP)Qt.width=0;else if(Se===R.SHRINK){if(ie.width>c.w){s=!1;break}Qt.width=0}if(Qt.height>0&&Qt.width>0){var p=this._determineRect(),_=u.x+re[u.line];this.appendQuad(Jt,t,Qt,p,_-i,l-n,fe)}}else console.warn("Can't find letter in this bitmap-font")}}return s},appendQuad:function(){},_determineRect:function(){var t=de.isRotated(),e=de.getOriginalSize(),r=de.getRect(),a=de.getOffset(),i=a.x+(e.width-r.width)/2,n=a.y-(e.height-r.height)/2;if(t){var s=Qt.x;Qt.x=r.x+r.height-Qt.y-Qt.height-n,Qt.y=s+r.y-i,Qt.y<0&&(Qt.height+=n)}else Qt.x+=r.x-i,Qt.y+=r.y+n;return t},_computeAlignmentOffset:function(){switch(re.length=0,xe){case O.LEFT:for(var t=0;t<oe;++t)re.push(0);break;case O.CENTER:for(var e=0,r=ee.length;e<r;e++)re.push((ie.width-ee[e])/2);break;case O.RIGHT:for(var a=0,i=ee.length;a<i;a++)re.push(ie.width-ee[a])}if(ue=ie.height,ge!==H.TOP){var n=ie.height-he+me*this._getFontScale()-_e*fe;ge===H.BOTTOM?ue-=n:ue-=n/2}},_setupBMFontOverflowMetrics:function(){var t=ie.width,e=ie.height;Se===R.RESIZE_HEIGHT&&(e=0),Se===R.NONE&&(t=0,e=0),we=t,Be=e,ae.width=t,ae.height=e,Ce=t}},be=new a(255,255,255,255),Te={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){var r=t.node;t._setCacheAlpha(r._uiProps.opacity),be.set(t.color),be.a=255*r._uiProps.opacity,ct(r,e,t.renderData,be)},appendQuad:function(t,e,r,a,i,n,s){var o=t.renderData;if(o){var h=o.dataLength;o.dataLength+=4,o.vertexCount=o.dataLength,o.indicesCount=o.dataLength/2*3;var u=o.data,c=e.width,l=e.height,f=r.width,d=r.height,v=0,p=0,_=0,x=0;a?(v=r.x/c,x=(r.x+d)/c,p=(r.y+f)/l,_=r.y/l,u[h].u=v,u[h].v=_,u[h+1].u=v,u[h+1].v=p,u[h+2].u=x,u[h+2].v=_,u[h+3].u=x,u[h+3].v=p):(v=r.x/c,x=(r.x+f)/c,p=(r.y+d)/l,_=r.y/l,u[h].u=v,u[h].v=p,u[h+1].u=x,u[h+1].v=p,u[h+2].u=v,u[h+2].v=_,u[h+3].u=x,u[h+3].v=_),u[h].x=i,u[h].y=n-d*s,u[h+1].x=i+f*s,u[h+1].y=n-d*s,u[h+2].x=i,u[h+2].y=n,u[h+3].x=i+f*s,u[h+3].y=n}}};o(Te,Me);var Fe=null,Le=h(Me,{getAssemblerData:function(){return Fe||(Fe=new I(1024,1024)),Fe.getTexture()},_updateFontFamily:function(t){A.fontAtlas=Fe,A.fontFamily=this._getFontFamily(t);var e=t.getComponent(rt);e&&e.enabled?(A.isOutlined=!0,A.margin=e.width,A.out=e.color.clone(),A.out.a=e.color.a*t.color.a/255):(A.isOutlined=!1,A.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){A.fontDesc=this._getFontDesc(),A.color=t.color,A.hash=N(A)},_getFontDesc:function(){return A.fontSize.toString()+"px "+A.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),Ae=new a(255,255,255,255),Re={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var r=t.node;t._setCacheAlpha(r._uiProps.opacity),Ae.a=255*r._uiProps.opacity,ct(r,e,t.renderData,Ae)}},appendQuad:Te.appendQuad};o(Re,Le);var Ee=k.Overflow,Pe=W(),Oe=(1/255).toFixed(3),He=null,Ie=null,Ne=null,ke="",ze="",Ve=0,Ue=0,We=[],Ze=new n,qe=0,Ge=0,Xe=0,je=new a,Ke=1,Qe="",Je=Ee.NONE,Ye=!1,$e=null,tr=a.BLACK.clone(),er=null,rr=a.BLACK.clone(),ar=new i,ir=n.ZERO.clone(),nr=n.ZERO.clone(),sr=s.ZERO.clone(),or=s.ZERO.clone(),hr=0,ur=0,cr=!1,lr=!1,fr=!1,dr=["left","center","right"],vr={getAssemblerData:function(){return k._canvasPool.get()},resetAssemblerData:function(t){t&&k._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(t),this._updateTexture(t),this.updateOpacity(t),t._setCacheAlpha(Ke),this._calDynamicAtlas(t),t.actualFontSize=Ve,e.setContentSize(Ze),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),He=null,Ie=null,Ne=null}},updateVertexData:function(){},updateUvs:function(){},updateOpacity:function(t){for(var e=t.renderData.vData,r=5,a=t.node._uiProps.opacity,i=0;i<4;i++)e[r+3]=a,r+=9},_updateFontFamily:function(t){Qe=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var r=t.assemblerData;r&&(He=r.context,Ie=r.canvas,Ne=t.spriteFrame,ze=t.string.toString(),Ve=t.fontSize,Ue=Ve,Je=t.overflow,nr.width=Ze.width=e.width,nr.height=Ze.height=e.height,ur=t.underlineHeight,qe=t.lineHeight,Ge=t.horizontalAlign,Xe=t.verticalAlign,je=t.color,Ke=t.node._uiProps.opacity,cr=t.isBold,lr=t.isItalic,fr=t.isUnderline,Ye=Je!==Ee.NONE&&(Je===Ee.RESIZE_HEIGHT||t.enableWrapText),($e=($e=rt&&t.getComponent(rt))&&$e.enabled&&$e.width>0?$e:null)&&tr.set($e.color),(er=(er=at&&t.getComponent(at))&&er.enabled?er:null)&&rr.set(er.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,r=0,a=0,i=0;if(ir.width=ir.height=0,$e&&(t=e=r=a=i=$e.width,ir.width=ir.height=2*i),er){var n=er.blur+i,s=er.offset.x,o=er.offset.y;r=Math.max(r,-s+n),a=Math.max(a,s+n),t=Math.max(t,o+n),e=Math.max(e,-o+n)}if(lr){var h=Ue*Math.tan(.20943951);a+=h,ir.width+=h}ar.x=r,ar.y=t,ar.width=r+a,ar.height=t+e},_calculateFillTextStartPosition:function(){var t=0;Ge===O.RIGHT?t=Ze.width-ar.width:Ge===O.CENTER&&(t=(Ze.width-ar.width)/2);var e=this._getLineHeight()*(We.length-1),r=Ve*(1-U/2);if(Xe!==H.TOP){var a=e+ar.height+Ve-Ze.height;Xe===H.BOTTOM?r-=a+=U/2*Ve:r-=a/2}r+=Pe*Ve,sr.set(t+ar.x,r+ar.y)},_updateTexture:function(t){if(He&&Ie){He.clearRect(0,0,Ie.width,Ie.height),He.font=ke,this._calculateFillTextStartPosition();var e=this._getLineHeight();He.lineJoin="round",t._srcBlendFactor===u.SRC_ALPHA&&(He.fillStyle="rgba("+je.r+", "+je.g+", "+je.b+", "+Oe+")",He.fillRect(0,0,Ie.width,Ie.height)),He.fillStyle="rgb("+je.r+", "+je.g+", "+je.b+")";var r,a=sr.x,n=0;this._drawTextEffect(sr,e);for(var s=0;s<We.length;++s)n=sr.y+s*e,$e&&He.strokeText(We[s],a,n),He.fillText(We[s],a,n);er&&(He.shadowColor="transparent"),Ne&&(r=Ne instanceof L?Ne.texture:Ne,0!==Ie.width&&0!==Ie.height&&(r.reset({width:Ie.width,height:Ie.height,mipmapLevel:1}),r.uploadData(Ie),Ne instanceof L&&(Ne.rect=new i(0,0,Ie.width,Ie.height),Ne._calculateUV()),c.director.root&&c.director.root.batcher2D&&c.director.root.batcher2D._releaseDescriptorSetCache(r.getHash())))}},_resetDynamicAtlas:function(t){if(t.cacheMode===k.CacheMode.BITMAP){var e=t.ttfSpriteFrame;F.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(t){if(t.cacheMode===k.CacheMode.BITMAP){var e=t.ttfSpriteFrame;F.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){He.strokeStyle="rgba("+tr.r+", "+tr.g+", "+tr.b+", "+tr.a/255+")",He.lineWidth=2*$e.width},_setupShadow:function(){He.shadowColor="rgba("+rr.r+", "+rr.g+", "+rr.b+", "+rr.a/255+")",He.shadowBlur=er.blur,He.shadowOffsetX=er.offset.x,He.shadowOffsetY=-er.offset.y},_drawTextEffect:function(t,e){if(er||$e||fr){var r=We.length>1&&er,a=this._measureText(He,ke),i=0,n=0;er&&this._setupShadow(),$e&&this._setupOutline();for(var s=0;s<We.length;++s)i=t.x,n=t.y+s*e,r&&($e&&He.strokeText(We[s],i,n),He.fillText(We[s],i,n)),fr&&(hr=a(We[s]),Ge===O.RIGHT?or.x=t.x-hr:Ge===O.CENTER?or.x=t.x-hr/2:or.x=t.x,or.y=n+Ue/8,He.fillRect(or.x,or.y,hr,ur));r&&(He.shadowColor="transparent")}},_updateLabelDimensions:function(){Ze.width=Math.min(Ze.width,2048),Ze.height=Math.min(Ze.height,2048);var t=!1;Ie.width!==Ze.width&&(Ie.width=Ze.width,t=!0),Ie.height!==Ze.height&&(Ie.height=Ze.height,t=!0),t&&(He.font=ke),He.textAlign=dr[Ge],He.textBaseline="alphabetic"},_getFontDesc:function(){var t=Ve.toString()+"px ";return t+=Qe,cr&&(t="bold "+t),lr&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===qe?Ve:qe*Ve/Ue)},_calculateParagraphLength:function(t,e){for(var r,a=[],i=l(t);!(r=i()).done;){var n=r.value,s=z(e,n,ke);a.push(s)}return a},_measureText:function(t,e){return function(r){return z(t,r,e)}},_calculateShrinkFont:function(t){if(He){var e=this._calculateParagraphLength(t,He),r=0,a=0,i=0;if(Ye){var n=nr.width,s=nr.height;if(n<0||s<0)return;a=s+1;for(var o=0,h=0|Ve+1,u=0;o<h;){if((u=o+h+1>>1)<=0){f(4003);break}Ve=u,ke=this._getFontDesc(),He.font=ke;var c=this._getLineHeight();for(a=0,r=0;r<t.length;++r){var l=z(He,t[r],ke);a+=V(t[r],l,n,this._measureText(He,ke)).length*c}a>s?h=u-1:o=u}0===o?f(4003):(Ve=o,ke=this._getFontDesc(),He.font=ke)}else{for(a=t.length*this._getLineHeight(),r=0;r<t.length;++r)i<e[r]&&(i=e[r]);var d=(Ze.width-ar.width)/i,v=Ze.height/a;Ve=Ue*Math.min(1,d,v)|0,ke=this._getFontDesc(),He.font=ke}}},_calculateWrapText:function(t){if(Ye&&He){We=[];for(var e=nr.width,r=0;r<t.length;++r){var a=z(He,t[r],ke),i=V(t[r],a,e,this._measureText(He,ke));We=We.concat(i)}}},_calculateLabelFont:function(){if(He){var t=ze.split("\n");switch(We=t,ke=this._getFontDesc(),He.font=ke,Je){case Ee.NONE:for(var e=0,r=0,a=0;a<t.length;++a){var i=z(He,t[a],ke);e=e>i?e:i}r=(We.length+U)*this._getLineHeight();var n=parseFloat(e.toFixed(2)),s=parseFloat(r.toFixed(2));Ze.width=n+ar.width,Ze.height=s+ar.height,nr.width=n+ir.width,nr.height=s+ir.height;break;case Ee.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case Ee.CLAMP:this._calculateWrapText(t);break;case Ee.RESIZE_HEIGHT:this._calculateWrapText(t);var o=(We.length+U)*this._getLineHeight();Ze.height=o+ar.height,nr.height=o+ir.height}}}},pr=a.WHITE.clone(),_r={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var r=e.vData=new Float32Array(36);r[3]=r[21]=r[22]=r[31]=0,r[4]=r[12]=r[13]=r[30]=1;for(var i=5,n=0;n<4;n++)a.toArray(r,pr,i),i+=9;return e},fillBuffers:function(t,e){var r=t.renderData,a=r.data,i=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,o=n.indicesOffset,h=n.vertexOffset;n.request()||(n=e.currBufferBatch,o=0,h=0,s=0);var u=n.vData,c=n.iData,l=r.vData,f=a[0],d=a[3];i.updateWorldTransform();var v=i._pos,p=i._rot,_=i._scale,x=f.x*_.x,g=d.x*_.x,y=f.y*_.y,m=d.y*_.y,S=p.x,D=p.y,w=p.z,B=p.w,C=S*D,M=w*B,b=S*S-D*D,T=B*B-w*w,F=T+b,L=2*(C-M),A=T-b,R=2*(C+M),E=v.x,P=v.y;l[0]=F*x+L*y+E,l[1]=A*y+R*x+P,l[9]=F*g+L*y+E,l[10]=A*y+R*g+P,l[18]=F*x+L*m+E,l[19]=A*m+R*x+P,l[27]=F*g+L*m+E,l[28]=A*m+R*g+P,u.set(l,s),c[o++]=h,c[o++]=h+1,c[o++]=h+2,c[o++]=h+2,c[o++]=h+1,c[o++]=h+3},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=r.width,i=r.height,n=r.anchorX*a,s=r.anchorY*i,o=e.data;o[0].x=-n,o[0].y=-s,o[3].x=a-n,o[3].y=i-s}},updateUvs:function(t){var e=t.renderData;if(e){var r=e.vData;if(r&&e.uvDirty){var a=t.ttfSpriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1}}}};o(_r,vr);var xr=t("l",{getAssembler:function(t){var e=_r;return t.font instanceof Z?e=Te:t.cacheMode===k.CacheMode.CHAR&&(e=Re),e}});k.Assembler=xr;var gr=q.FillType,yr=new r,mr=new a(255,255,255,255),Sr={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;F.packToDynamicAtlas(t,e);var r=t.renderData;if(r&&e){var a=r.uvDirty,i=r.vertDirty;if(!a&&!i)return;var n=t.fillStart,s=t.fillRange;s<0&&(n+=s,s=-s),s=(s=(s=n+s)>1?1:s)<0?0:s;var o=(n=(n=n>1?1:n)<0?0:n)+(s=(s-=n)<0?0:s);o=o>1?1:o,a&&this.updateUVs(t,n,o),i&&(this.updateVertexData&&this.updateVertexData(t,n,o),this.updateWorldVertexData(t))}},updateUVs:function(t,e,r){var a=t.spriteFrame,i=t.renderData,n=i.data,s=a.width,o=a.height,h=a.getRect(),u=0,c=0,l=0,f=0,v=0,p=0,_=0,x=0,g=0,y=0;switch(a.isRotated()?(u=h.x/s,c=(h.y+h.width)/o,l=v=u,_=g=(h.x+h.height)/s,p=y=c,f=x=h.y/o):(u=h.x/s,c=(h.y+h.height)/o,l=_=u,v=g=(h.x+h.width)/s,f=p=c,x=y=h.y/o),t.fillType){case gr.HORIZONTAL:n[0].u=l+(v-l)*e,n[0].v=f+(p-f)*e,n[1].u=l+(v-l)*r,n[1].v=f+(p-f)*r,n[2].u=_+(g-_)*e,n[2].v=x+(y-x)*e,n[3].u=_+(g-_)*r,n[3].v=x+(y-x)*r;break;case gr.VERTICAL:n[0].u=l+(_-l)*e,n[0].v=f+(x-f)*e,n[1].u=v+(g-v)*e,n[1].v=p+(y-p)*e,n[2].u=l+(_-l)*r,n[2].v=f+(x-f)*r,n[3].u=v+(g-v)*r,n[3].v=p+(y-p)*r;break;default:d(2626)}i.uvDirty=!1},updateVertexData:function(t,e,r){var a=t.renderData,i=a.data,n=t.node._uiProps.uiTransformComp,s=n.width,o=n.height,h=n.anchorX*s,u=n.anchorY*o,c=-h,l=-u,f=s-h,v=o-u,p=0;switch(t.fillType){case gr.HORIZONTAL:p=c+(f-c)*r,c+=(f-c)*e,f=p;break;case gr.VERTICAL:p=l+(v-l)*r,l+=(v-l)*e,v=p;break;default:d(2626)}i[4].x=c,i[4].y=l,i[5].x=f,i[5].y=l,i[6].x=c,i[6].y=v,i[7].x=f,i[7].y=v,a.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var r,a=e.data,i=l(a);!(r=i()).done;)r.value.z=0;return e},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(yr);for(var i=0;i<4;i++){var n=a[i+4],s=a[i];e.transformMat4(s,n,yr)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=t.node;mr.set(t.color),mr.a=255*r._uiProps.opacity,function(t,e,r,i){var n=r.data,s=e.acquireBufferBatch(),o=s.byteOffset>>2,h=r.vertexCount,u=s.indicesOffset,c=s.vertexOffset;s.request(h,r.indicesCount)||(s=e.currBufferBatch,o=0,u=0,c=0);for(var l=s.vData,f=0;f<h;f++){var d=n[f];l[o++]=d.x,l[o++]=d.y,l[o++]=d.z,l[o++]=d.u,l[o++]=d.v,a.toArray(l,i,o),o+=4}var v=s.iData;v[u++]=c,v[u++]=c+1,v[u++]=c+2,v[u++]=c+1,v[u++]=c+3,v[u++]=c+2}(0,e,t.renderData,mr)},updateColor:function(){}},Dr=2*Math.PI,wr=1e-6,Br=new a(255,255,255,255),Cr=[new s,new s,new s,new s],Mr=new Array(4),br=new Array(8),Tr=[new s,new s,new s,new s],Fr=[new s,new s,new s,new s],Lr=new s,Ar=[new s,new s,new s,new s];function Rr(t,e,r,a,i,n,s){var o=Math.sin(n);o=Math.abs(o)>wr?o:0;var h=Math.cos(n),u=0,c=0;if(0!==(h=Math.abs(h)>wr?h:0)){if(u=o/h,(t-i.x)*h>0){var l=i.y+u*(t-i.x);s[0].x=t,s[0].y=l}if((e-i.x)*h>0){var f=i.y+u*(e-i.x);s[2].x=e,s[2].y=f}}if(0!==o){if(c=h/o,(a-i.y)*o>0){var d=i.x+c*(a-i.y);s[3].x=d,s[3].y=a}if((r-i.y)*o>0){var v=i.x+c*(r-i.y);s[1].x=v,s[1].y=r}}}function Er(t,e){var r=e.x-t.x,a=e.y-t.y;if(0===r&&0===a)return 0;if(0===r)return a>0?.5*Math.PI:1.5*Math.PI;var i=Math.atan(a/r);return r<0&&(i+=Math.PI),i}function Pr(t,e,r,a,i){var n=Mr,s=n[0],o=n[1],h=n[2],u=n[3];t[e].x=r.x,t[e].y=r.y,t[e+1].x=a.x,t[e+1].y=a.y,t[e+2].x=i.x,t[e+2].y=i.y,Or((r.x-s)/(h-s),(r.y-o)/(u-o),t,e),Or((a.x-s)/(h-s),(a.y-o)/(u-o),t,e+1),Or((i.x-s)/(h-s),(i.y-o)/(u-o),t,e+2)}function Or(t,e,r,a){var i=br,n=i[0]+(i[2]-i[0])*t,s=i[4]+(i[6]-i[4])*t,o=i[1]+(i[3]-i[1])*t,h=i[5]+(i[7]-i[5])*t,u=r[a];u.u=n+(s-n)*e,u.v=o+(h-o)*e}for(var Hr={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;F.packToDynamicAtlas(t,e);var r,a,i,n,o,h,u,c,f,d=t.renderData;if(d&&e&&(d.vertDirty||d.uvDirty)){var v=d.data,p=t.fillStart,_=t.fillRange;for(_<0&&(p+=_,_=-_);p>=1;)p-=1;for(;p<0;)p+=1;var x=(p*=Dr)+(_*=Dr);!function(t){var e=t.node._uiProps.uiTransformComp,r=e.width,a=e.height,i=e.anchorX*r,n=e.anchorY*a,o=-i,h=-n,u=r-i,c=a-n,f=Mr;f[0]=o,f[1]=h,f[2]=u,f[3]=c;var d=t.fillCenter,v=Lr.x=Math.min(Math.max(0,d.x),1)*(u-o)+o,p=Lr.y=Math.min(Math.max(0,d.y),1)*(c-h)+h;Cr[0].x=Cr[3].x=o,Cr[1].x=Cr[2].x=u,Cr[0].y=Cr[1].y=h,Cr[2].y=Cr[3].y=c;for(var _,x=l(Ar);!(_=x()).done;){var g=_.value;s.set(g,0,0)}v!==f[0]&&s.set(Ar[0],3,0),v!==f[2]&&s.set(Ar[2],1,2),p!==f[1]&&s.set(Ar[1],0,1),p!==f[3]&&s.set(Ar[3],2,3)}(t),a=(r=e).width,i=r.height,n=r.getRect(),o=0,h=0,u=0,c=0,f=br,r.isRotated()?(o=n.x/a,h=(n.x+n.height)/a,u=n.y/i,c=(n.y+n.width)/i,f[0]=f[2]=o,f[4]=f[6]=h,f[3]=f[7]=c,f[1]=f[5]=u):(o=n.x/a,h=(n.x+n.width)/a,u=n.y/i,c=(n.y+n.height)/i,f[0]=f[4]=o,f[2]=f[6]=h,f[1]=f[3]=c,f[5]=f[7]=u),Rr(Mr[0],Mr[2],Mr[1],Mr[3],Lr,p,Tr),Rr(Mr[0],Mr[2],Mr[1],Mr[3],Lr,p+_,Fr);for(var g=0,y=0;y<4;++y){var m=Ar[y];if(m)if(_>=Dr)d.dataLength=g+3,Pr(v,g,Lr,Cr[m.x],Cr[m.y]),g+=3;else{var S=Er(Lr,Cr[m.x]),D=Er(Lr,Cr[m.y]);D<S&&(D+=Dr),S-=Dr,D-=Dr;for(var w=0;w<3;++w)S>=x||(S>=p?(d.dataLength=g+3,Pr(v,g,Lr,Cr[m.x],D>=x?Fr[y]:Cr[m.y]),g+=3):D>p&&(D<=x?(d.dataLength=g+3,Pr(v,g,Lr,Tr[y],Cr[m.y]),g+=3):(d.dataLength=g+3,Pr(v,g,Lr,Tr[y],Fr[y]),g+=3))),S+=Dr,D+=Dr}}d.indicesCount=d.vertexCount=g,d.vertDirty=d.uvDirty=!1}},fillBuffers:function(t,r){var i=t.node,n=t.renderData;Br.set(t.color),Br.a=255*i._uiProps.opacity,function(t,r,i,n){var s=i.data,o=r.acquireBufferBatch(),h=o.byteOffset>>2,u=i.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(u,i.indicesCount)||(o=r.currBufferBatch,h=0,c=0,l=0);var f=o.vData;t.getWorldMatrix(ut);for(var d=0;d<u;d++){var v=s[d];e.set(ht,v.x,v.y,0),e.transformMat4(ht,ht,ut),f[h++]=ht.x,f[h++]=ht.y,f[h++]=ht.z,f[h++]=v.u,f[h++]=v.v,a.toArray(f,n,h),h+=4}for(var p=o.iData,_=0;_<i.dataLength;_++)p[c+_]=l+_}(i,r,n,Br)},updateColor:function(){}},Ir=[],Nr=0;Nr<4;Nr++)Ir.push(new e);for(var kr={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;F.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&(r.vertDirty&&this.updateVertexData(t),r.uvDirty&&this.updateUvs(t))},updateWorldVerts:function(t,e){var r=t.renderData.data,a=t.node,i=r[0],n=r[3],s=a.worldMatrix,o=s.m00,h=s.m01,u=s.m04,c=s.m05,l=1===o&&0===h&&0===u&&1===c,f=s.m12,d=s.m13,v=i.x,p=n.x,_=i.y,x=n.y;if(l){var g=v+f,y=p+f,m=_+d,S=x+d;e[0]=g,e[1]=m,e[9]=y,e[10]=m,e[18]=g,e[19]=S,e[27]=y,e[28]=S}else{var D=o*v,w=o*p,B=h*v,C=h*p,M=u*_+f,b=u*x+f,T=c*_+d,F=c*x+d;e[0]=D+M,e[1]=B+T,e[9]=w+M,e[10]=C+T,e[18]=D+b,e[19]=B+F,e[27]=w+b,e[28]=C+F}a._uiProps.uiTransformDirty=!1},fillBuffers:function(t,e){if(null!==t){var r=t.renderData.vData;t.node._uiProps.uiTransformDirty&&this.updateWorldVerts(t,r);var a=e.acquireBufferBatch(),i=a.byteOffset>>2,n=a.indicesOffset,s=a.vertexOffset;a.request()||(a=e.currBufferBatch,i=0,n=0,s=0);var o=a.vData,h=a.iData;o.set(r,i);var u=s,c=s+1,l=s+2,f=s+3;h[n++]=u,h[n++]=c,h[n++]=l,h[n++]=l,h[n++]=c,h[n++]=f}},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=e.data,i=r.width,n=r.height,s=r.anchorX*i,o=r.anchorY*n,h=0,u=0,c=0,l=0;if(t.trim)h=-s,u=-o,c=i-s,l=n-o;else{var f=t.spriteFrame,d=f.getOriginalSize(),v=f.getRect(),p=d.width,_=d.height,x=v.width,g=v.height,y=f.getOffset(),m=i/p,S=n/_,D=y.x+(p-x)/2,w=y.x-(p-x)/2;h=D*m-s,u=(y.y+(_-g)/2)*S-o,c=i+w*m-s,l=n+(y.y-(_-g)/2)*S-o}a[0].x=h,a[0].y=u,a[3].x=c,a[3].y=l,e.vertDirty=!1,this.updateWorldVerts(t,e.vData)}},updateUvs:function(t){var e=t.renderData,r=e.vData,a=t.spriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,r=5,a=t.color,i=a.r/255,n=a.g/255,s=a.b/255,o=t.node._uiProps.opacity,h=0;h<4;h++)e[r]=i,e[r+1]=n,e[r+2]=s,e[r+3]=o,r+=9}},zr=new e,Vr=new r,Ur={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;F.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&r.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,r=e.data,a=t.node._uiProps.uiTransformComp,i=a.width,n=a.height,s=a.anchorX*i,o=a.anchorY*n,h=t.spriteFrame,u=h.insetLeft,c=h.insetRight,l=h.insetTop,f=h.insetBottom,d=i-u-c,v=n-l-f,p=i/(u+c),_=n/(l+f);p=Number.isNaN(p)||p>1?1:p,_=Number.isNaN(_)||_>1?1:_,d=d<0?0:d,v=v<0?0:v,r[0].x=-s,r[0].y=-o,r[1].x=u*p-s,r[1].y=f*_-o,r[2].x=r[1].x+d,r[2].y=r[1].y+v,r[3].x=i-s,r[3].y=n-o,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=e.acquireBufferBatch(),i=t.renderData,n=i.data,s=r.byteOffset>>2,o=i.vertexCount,h=r.indicesOffset,u=r.vertexOffset,c=t.spriteFrame.uvSliced;r.request(o,i.indicesCount)||(r=e.currBufferBatch,s=0,h=0,u=0);for(var l=r.vData,f=r.iData,d=4;d<20;++d){var v=n[d],p=c[d-4];l[s++]=v.x,l[s++]=v.y,l[s++]=v.z,l[s++]=p.u,l[s++]=p.v,a.toArray(l,n[d].color,s),s+=4}for(var _=0;_<3;++_)for(var x=0;x<3;++x){var g=u+4*_+x;f[h++]=g,f[h++]=g+1,f[h++]=g+4,f[h++]=g+1,f[h++]=g+5,f[h++]=g+4}},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(Vr);for(var i=0;i<4;++i)for(var n=a[i],s=0;s<4;++s){var o=a[s],h=a[4+4*i+s];e.set(zr,o.x,n.y,0),e.transformMat4(h,zr,Vr)}},updateColor:function(t){for(var e=t.renderData.data,r=t.color,a=r.r,i=r.g,n=r.b,s=255*t.node._uiProps.opacity,o=4;o<20;o++)e[o].color.r=a,e[o].color.g=i,e[o].color.b=n,e[o].color.a=s}},Wr=[],Zr=0;Zr<4;Zr++)Wr.push(new e);var qr={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,r=t.spriteFrame;if(r&&e&&(e.uvDirty||e.vertDirty)){var a=t.node._uiProps.uiTransformComp,i=Math.abs(a.width),n=Math.abs(a.height),s=r.getRect(),o=r.insetLeft,h=r.insetRight,u=s.width-o-h,c=r.insetTop,l=r.insetBottom,f=s.height-c-l,d=i-o-h,v=n-c-l;d=d>0?d:0,v=v>0?v:0;var p=0===u?d:d/u,_=0===f?v:v/f,x=Math.ceil(_+2),g=Math.ceil(p+2);e.dataLength=Math.max(8,x+1,g+1),this.updateVerts(t,d,v,x,g),e.vertexCount=x*g*4,e.indicesCount=x*g*6,e.uvDirty=!1,e.vertDirty=!1,this.updateColor(t)}},fillBuffers:function(t,e){var r=t.node,i=t.node._uiProps.uiTransformComp,n=Math.abs(i.width),s=Math.abs(i.height),o=t.renderData,h=e.acquireBufferBatch(),u=h.indicesOffset,c=h.byteOffset>>2,l=h.vertexOffset,f=o.vertexCount,d=o.indicesCount,v=h.vData,p=h.iData;h.request(f,d)||(h=e.currBufferBatch,c=0,u=0,l=0);var _=t.spriteFrame,x=_.isRotated(),g=_.uv,y=t.spriteFrame.uvSliced,m=_.getRect(),S=_.insetLeft,D=_.insetRight,w=m.width-S-D,B=_.insetTop,C=_.insetBottom,M=m.height-B-C,b=n-S-D,T=s-B-C;b=b>0?b:0,T=T>0?T:0;var F=0===w?b:b/w,L=0===M?T:T/M,A=Math.ceil(L+2),R=Math.ceil(F+2),E=r.worldMatrix,P=o.data;this.fillVertices(v,c,E,A,R,P);for(var O=0,H=0,I=[],N=[],k=0,z=A;k<z;++k){H=T>M?T>=k*M?1:L%1:L;for(var V=0,U=R;V<U;++V){O=b>w?b>=V*w?1:F%1:F;var W=c+3,Z=W+1;x?(0===k?(I[0]=y[0].u,I[1]=y[0].u,I[2]=y[4].u+(y[8].u-y[4].u)*H):k<A-1?(I[0]=y[4].u,I[1]=y[4].u,I[2]=y[4].u+(y[8].u-y[4].u)*H):k===A-1&&(I[0]=y[8].u,I[1]=y[8].u,I[2]=y[12].u),0===V?(N[0]=y[0].v,N[1]=y[1].v+(y[2].v-y[1].v)*O,N[2]=y[0].v):V<R-1?(N[0]=y[1].v,N[1]=y[1].v+(y[2].v-y[1].v)*O,N[2]=y[1].v):V===R-1&&(N[0]=y[2].v,N[1]=y[3].v,N[2]=y[2].v),I[3]=I[2],N[3]=N[1]):(0===V?(I[0]=y[0].u,I[1]=y[1].u+(y[2].u-y[1].u)*O,I[2]=g[0]):V<R-1?(I[0]=y[1].u,I[1]=y[1].u+(y[2].u-y[1].u)*O,I[2]=y[1].u):V===R-1&&(I[0]=y[2].u,I[1]=y[3].u,I[2]=y[2].u),0===k?(N[0]=y[0].v,N[1]=y[0].v,N[2]=y[4].v+(y[8].v-y[4].v)*H):k<A-1?(N[0]=y[4].v,N[1]=y[4].v,N[2]=y[4].v+(y[8].v-y[4].v)*H):k===A-1&&(N[0]=y[8].v,N[1]=y[8].v,N[2]=y[12].v),I[3]=I[1],N[3]=N[2]),v[W]=I[0],v[Z]=N[0],v[W+9]=I[1],v[Z+9]=N[1],v[W+18]=I[2],v[Z+18]=N[2],v[W+27]=I[3],v[Z+27]=N[3],a.toArray(v,P[0].color,Z+1),a.toArray(v,P[0].color,Z+9+1),a.toArray(v,P[0].color,Z+18+1),a.toArray(v,P[0].color,Z+27+1),c+=36}}for(var q=0;q<d;q+=6)p[u++]=l,p[u++]=l+1,p[u++]=l+2,p[u++]=l+1,p[u++]=l+3,p[u++]=l+2,l+=4},fillVertices:function(t,r,a,i,n,s){for(var o=0,h=0,u=0,c=0,l=0,f=i;l<f;++l){u=s[l].y,c=s[l+1].y;for(var d=0,v=n;d<v;++d){o=s[d].x,h=s[d+1].x,e.set(Wr[0],o,u,0),e.set(Wr[1],h,u,0),e.set(Wr[2],o,c,0),e.set(Wr[3],h,c,0);for(var p=0;p<4;p++){var _=Wr[p];e.transformMat4(_,_,a);var x=9*p;t[r+x]=_.x,t[r+x+1]=_.y,t[r+x+2]=_.z}r+=36}}},updateVerts:function(t,e,r,a,i){var n,s,o=t.node._uiProps.uiTransformComp,h=t.renderData.data,u=t.spriteFrame,c=u.getRect(),l=Math.abs(o.width),f=Math.abs(o.height),d=o.anchorX*l,v=o.anchorY*f,p=u.insetLeft,_=u.insetRight,x=c.width-p-_,g=u.insetTop,y=u.insetBottom,m=c.height-g-y,S=o.width/(p+_)>1?1:o.width/(p+_),D=o.height/(g+y)>1?1:o.height/(g+y);n=x>0?Math.floor(1e3*e)/1e3%x==0?x:e%x:e,s=m>0?Math.floor(1e3*r)/1e3%m==0?m:r%m:r;for(var w=0;w<=i;w++)0===w?h[w].x=-d:w>0&&w<i?h[w].x=1===w?p*S+Math.min(x,e)-d:x>0?w===i-1?p+n+x*(w-2)-d:p+Math.min(x,e)+x*(w-2)-d:p+e-d:w===i&&(h[w].x=Math.min(p+e+_,l)-d);for(var B=0;B<=a;B++)0===B?h[B].y=-v:B>0&&B<a?h[B].y=1===B?y*D+Math.min(m,r)-v:m>0?B===a-1?y+s+(B-2)*m-v:y+Math.min(m,r)+(B-2)*m-v:y+r-v:B===a&&(h[B].y=Math.min(y+r+g,f)-v)},updateColor:function(t){var e=t.renderData.data,r=e.length;if(0!==r)for(var a=t.color,i=a.r,n=a.g,s=a.b,o=255*t.node._uiProps.opacity,h=0;h<r;h++)e[h].color.r=i,e[h].color.g=n,e[h].color.b=s,e[h].color.a=o}},Gr=q.Type,Xr=q.FillType,jr=t("s",{getAssembler:function(t){var e=kr,r=t;switch(r.type){case Gr.SLICED:e=Ur;break;case Gr.TILED:e=qr;break;case Gr.FILLED:e=r.fillType===Xr.RADIAL?Hr:Sr}return e}});q.Assembler=jr;var Kr=X.sharedManager,Qr={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===nt.IMAGE_STENCIL&&(kr.updateRenderData(t),kr.updateColor(t))},fillBuffers:function(t,e){(t.type!==nt.IMAGE_STENCIL||t.spriteFrame)&&(Kr.pushMask(t),e.finishMergeBatches(),function(t,e){Kr.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(Kr.enterLevel(t),t.type===nt.IMAGE_STENCIL){kr.fillBuffers(t,e);var r=t.graphics.getMaterialInstance(0);e.forceMergeBatches(r,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),Kr.enableMask())}},Jr={fillBuffers:function(){Kr.exitMask()}},Yr={getAssembler:function(){return Qr}},$r={getAssembler:function(){return Jr}};it.Assembler=Yr,it.PostAssembler=$r;var ta=new g(null),ea=new r,ra=t("B",function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new y((function(){return new st(e)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new m,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currOpacity=1,this._descriptorSetCache=new ia,this._root=t,this.device=t.device,this._batches=new S(64),this._drawBatchPool=new D((function(){return new ot}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=tt);var e=t===tt?36:et(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var r;t instanceof st?r=t:(r=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var a=r.vertexFormatBytes,i=this._customMeshBuffers.get(a);return i||(i=[],this._customMeshBuffers.set(a,i)),i.push(r),r},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var r=0;r<e.length;r++)if(e[r]===t){e.splice(r,1);break}var a=this._bufferBatchPool.data.indexOf(t);-1!==a&&(t.reset(),this._bufferBatchPool.removeAt(a))},t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var r,a=l(this._meshBuffers.keys());!(r=a()).done;){var i=r.value,n=this._meshBuffers.get(i);n&&n.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),X.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,r=0;r<e.length;r++){var a=e[r];if(a.visibility&t.layer)return a}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var r=t[e];r.enabledInHierarchy&&(this._currOpacity=1,this._recursiveScreenNode(r.node))}var a=0;if(this._batches.length)for(var i=0;i<this._batches.length;++i){var n=this._batches.array[i];if(n.renderScene){if(n.model)for(var s=n.model.subModels,o=0;o<s.length;o++)s[o].priority=a++;else n.descriptorSet=this._descriptorSetCache.getDescriptorSet(n);n.renderScene.addBatch(n)}}},t.uploadBuffers=function(){var t=this;this._batches.length>0&&(this._doUploadBuffersCall.forEach((function(e,r){e.call(r,t)})),this._meshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._customMeshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._descriptorSetCache.update())},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._currOpacity=1,this._meshBufferUseCount.clear(),this._batches.clear(),X.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,r,a){var i,n,s=t,o=0,h=0;e?(i=e.getGFXTexture(),n=e.getGFXSampler(),o=e.getHash(),h=e.getSamplerHash()):(i=null,n=null);var u=s._getRenderScene(),c=s.getRenderMaterial(0);s.stencilStage=X.sharedManager.stage;var l=s.blendHash,f=s.stencilStage;this._currScene===u&&this._currLayer===t.node.layer&&this._currMaterial===c&&this._currBlendTargetHash===l&&this._currDepthStencilStateStage===f&&this._currTextureHash===o&&this._currSamplerHash===h&&this._currTransform===a||(this.autoMergeBatches(this._currComponent),this._currScene=u,this._currComponent=s,this._currTransform=a,this._currMaterial=c,this._currTexture=i,this._currSampler=n,this._currTextureHash=o,this._currSamplerHash=h,this._currBlendTargetHash=l,this._currDepthStencilStateStage=f,this._currLayer=t.node.layer),r&&r.fillBuffers(s,this)},t.commitModel=function(t,e,r){var a;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var i=0;r&&(t.stencilStage!==j.ENABLED&&t.stencilStage!==j.DISABLED||(t.stencilStage=X.sharedManager.stage),a=X.sharedManager.getStencilStage(t.stencilStage,r),i=X.sharedManager.getStencilHash(t.stencilStage));var n=c.director.getTotalFrames();e&&(e.updateTransform(n),e.updateUBOs(n));for(var s=0;s<e.subModels.length;s++){var o=this._drawBatchPool.alloc(),h=e.subModels[s];o.renderScene=t._getRenderScene(),o.visFlags=t.node.layer,o.model=e,o.bufferBatch=null,o.texture=null,o.sampler=null,o.useLocalData=null,a||(a=null),o.fillPasses(r,a,i,null,0,h.patches),o.descriptorSet=h.descriptorSet,o.inputAssembler=h.inputAssembler,o.model.visFlags=o.visFlags,this._batches.push(o)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,r=null==e?void 0:e.recordBatch(),a=this._currMaterial;if(r&&a&&e){var i,n,s=0,o=0;t&&(i=-1===t.blendHash?null:t.getBlendState(),o=t.blendHash,n=null!==t.customMaterial?X.sharedManager.getStencilStage(t.stencilStage,a):X.sharedManager.getStencilStage(t.stencilStage),s=X.sharedManager.getStencilHash(t.stencilStage));var h=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();h.renderScene=this._currScene,h.visFlags=this._currLayer,h.bufferBatch=e,h.texture=this._currTexture,h.sampler=this._currSampler,h.inputAssembler=r,h.useLocalData=this._currTransform,h.textureHash=this._currTextureHash,h.samplerHash=this._currSamplerHash,h.fillPasses(a,n,s,i,o,null),this._batches.push(h),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,v.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,r){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=r.node.layer,this._currScene=r._getRenderScene(),this.autoMergeBatches(r)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var r=t.children.length;if(this._preProcess(t),r>0&&!t._static)for(var a=t.children,i=0;i<a.length;++i){this._currOpacity=t._uiProps.opacity;var n=a[i];this.walk(n,e)}this._postProcess(t),e+=1},t._preProcess=function(t){var e=t._uiProps.uiComp,r=t._uiProps.localOpacity;t._uiProps.opacity=this._currOpacity*r,t._uiProps.uiTransformComp&&e&&e.enabledInHierarchy&&e.updateAssembler(this)},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var r=et(t),a=this._meshBuffers.get(r);return a||(a=[],this._meshBuffers.set(r,a)),a.push(e),e},t._recreateMeshBuffer=function(t,e,r){this.autoMergeBatches(),this._requireBufferBatch(t,e,r)},t._requireBufferBatch=function(t,e,r){var a=et(t),i=this._meshBuffers.get(a);i||(i=[],this._meshBuffers.set(a,i));var n=this._meshBufferUseCount.get(a)||0;e&&r&&n++,this._currMeshBuffer=i[n],this._currMeshBuffer||(this._currMeshBuffer=this._createMeshBuffer(t)),this._meshBufferUseCount.set(a,n),e&&r&&this._currMeshBuffer.request(e,r)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},p(e,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),e}()),aa=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=c.director.root.device;this._localData=new Float32Array(_.COUNT),this._localBuffer=t.createBuffer(new w(B.UNIFORM|B.TRANSFER_DST,C.HOST|C.DEVICE,_.SIZE,_.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=c.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,ta.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(ta),this._descriptorSet.bindBuffer(_.BINDING,this._localBuffer);var r=x.SAMPLER_SPRITE;this._descriptorSet.bindTexture(r,t.texture),this._descriptorSet.bindSampler(r,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,r){return this._transform===t&&this._textureHash===e&&this._samplerHash===r},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;r.toArray(this._localData,e,_.MAT_WORLD_OFFSET),r.inverseTranspose(ea,e);var a=r.determinant(ea),i=1/Math.sqrt(a);r.multiplyScalar(ea,ea,i),r.toArray(this._localData,ea,_.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},p(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),ia=function(){function t(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new D((function(){return new aa}),16)}var e=t.prototype;return e.getDescriptorSet=function(t){var e=c.director.root;if(t.useLocalData){for(var r=this._localDescriptorSetCache,a=0,i=r.length;a<i;a++){var n=r[a];if(n.equals(t.useLocalData,t.textureHash,t.samplerHash))return n.descriptorSet}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.descriptorSet}var o=this._descriptorSetCache.get(t.textureHash);if(o&&o.has(t.samplerHash))return o.get(t.samplerHash);c.director.root.device,ta.layout=t.passes[0].localSetLayout;var h=e.device.createDescriptorSet(ta),u=x.SAMPLER_SPRITE;return h.bindTexture(u,t.texture),h.bindSampler(u,t.sampler),h.update(),o?this._descriptorSetCache.get(t.textureHash).set(t.samplerHash,h):this._descriptorSetCache.set(t.textureHash,new Map([[t.samplerHash,h]])),h},e.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){this._descriptorSetCache.has(t)&&(this._descriptorSetCache.get(t).forEach((function(t){t.destroy()})),this._descriptorSetCache.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.forEach((function(t){t.destroy()}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(t){t.destroy()}))},t}();c.internal.Batcher2D=ra;var na,sa=null,oa=-1,ha="BES bswy:->@123",ua=Object.create(null),ca=[],la=3e3;function fa(){for(var t=!0,e=Date.now(),r=ca.length-1;r>=0;r--){var a=ca[r],i=a.fontFamilyName;if(e-a.startTime>la)M(4933,i),a.onComplete(null,i),ca.splice(r,1);else{var n=a.refWidth,s="40px "+i;sa.font=s,n!==z(sa,ha,s)?(ca.splice(r,1),a.onComplete(null,i)):t=!1}}t&&(clearInterval(oa),oa=-1)}function da(t,e,r){var a=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var r,a=t.lastIndexOf("/");return-1!==(r=-1===a?t.substring(0,e)+"_LABEL":t.substring(a+1,e)+"_LABEL").indexOf(" ")&&(r='"'+r+'"'),r}(t);if(ua[a])r(null,a);else{if(!sa){var i=document.createElement("canvas");i.width=100,i.height=100,sa=i.getContext("2d")}var n=z(sa,ha,"40px "+a),s=document.createElement("style");s.type="text/css";var o="";Number.isNaN(a)?o+="@font-face { font-family:"+a+"; src:":o+='@font-face { font-family:"'+a+'"; src:',o+='url("'+t+'");',s.textContent=o+"}",document.body.appendChild(s);var h,u,c,l,f,d,v=document.createElement("div"),p=v.style;if(p.fontFamily=a,v.innerHTML=".",p.position="absolute",p.left="-100px",p.top="-100px",document.body.appendChild(v),function(){if(void 0===na)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);na=t?parseInt(t[1],10)>42:!e}else na=!1;return na}())h=Date.now(),u=a,c=r,l=new Promise((function(t,e){!function r(){Date.now()-h>=la?e():document.fonts.load("40px "+u).then((function(e){e.length>=1?t():setTimeout(r,100)}),(function(){e()}))}()})),f=null,d=new Promise((function(t,e){f=setTimeout(e,la)})),Promise.race([d,l]).then((function(){f&&(clearTimeout(f),f=null),c(null,u)}),(function(){M(4933,u),c(null,u)}));else{var _={fontFamilyName:a,refWidth:n,onComplete:r,startTime:Date.now()};ca.push(_),-1===oa&&(oa=setInterval(fa,100))}ua[a]=s}}function va(t,e,r,a){var i=new G;i._nativeUrl=t,i._nativeAsset=e,a(null,i)}b.register({".font":da,".eot":da,".ttf":da,".woff":da,".svg":da,".ttc":da}),T.register({".font":va,".eot":va,".ttf":va,".woff":va,".svg":va,".ttc":va}),c.UI={MeshBuffer:st,spriteAssembler:jr,graphicsAssembler:jt,labelAssembler:xr}}}}));
