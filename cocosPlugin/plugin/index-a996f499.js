System.register(["./json-asset-1f2be75e.js","./view-368b93a3.js","./deprecated-c0e66301.js","./camera-component-4c08f67b.js","./renderable-component-da5e0106.js","./transform-utils-ca30a5c5.js"],(function(e,t){"use strict";var i,n,r,s,a,o,u,c,h,l,d,f,p,m,_,g,v,y,w,T,b,A,E,S,N,x,R,I,P,k,C,D,M,F,B,L,O,U,W,V,j,H,z,q,G,X,Y,Q,J,K,Z,$,ee,te,ie,ne,re,se,ae,oe,ue,ce,he,le,de,fe,pe,me,_e,ge,ve,ye,we,Te,be,Ae,Ee,Se,Ne,xe,Re,Ie,Pe,ke,Ce,De,Me,Fe,Be,Le,Oe,Ue,We,Ve,je,He,ze,qe,Ge,Xe,Ye,Qe,Je,Ke,Ze,$e,et,tt,it,nt,rt,st,at,ot,ut,ct,ht,lt,dt,ft,pt,mt,_t,gt,vt,yt,wt,Tt,bt,At,Et,St,Nt,xt,Rt,It,Pt,kt,Ct,Dt,Mt,Ft,Bt,Lt,Ot,Ut,Wt,Vt,jt,Ht,zt,qt,Gt,Xt,Yt,Qt,Jt,Kt,Zt,$t,ei,ti,ii,ni,ri,si,ai,oi,ui,ci,hi,li,di,fi,pi,mi,_i,gi,vi,yi,wi,Ti,bi,Ai,Ei,Si,Ni,xi,Ri,Ii,Pi,ki,Ci,Di,Mi,Fi,Bi,Li,Oi,Ui,Wi,Vi,ji,Hi;return{setters:[function(e){i=e.c2,n=e.c3,r=e.c4,s=e.c5,a=e.c6,o=e.c7,u=e.c8,c=e.c9,h=e.ca,l=e.cb,d=e.cc,f=e.cd,p=e.ce,m=e.cf,_=e.cg,g=e.ch,v=e.ci,y=e.cj,w=e.ck,T=e.cl,b=e.cm,A=e.cn,E=e.co,S=e.cp,N=e.cq,x=e.cr,R=e.cs,I=e.ct,P=e.cu,k=e.cv,C=e.cw,D=e.cx,M=e.cy,F=e.cz,B=e.cA,L=e.cB,O=e.cC,U=e.cD,W=e.cE,V=e.cF,j=e.cG,H=e.cH,z=e.eX,q=e.eY,G=e.el,X=e.eZ,Y=e.e_,Q=e.e0,J=e.e$,K=e.ek,Z=e.e8,$=e.f0,ee=e.f1,te=e.e2,ie=e.f2,ne=e.f3,re=e.f4,se=e.f5,ae=e.f6,oe=e.f7,ue=e.f8,ce=e.f9,he=e.fa,le=e.fb,de=e.fc,fe=e.fd,pe=e.e,me=e.ao,_e=e.l,ge=e.ag,ve=e.aq,ye=e.z,we=e.G,Te=e.aH,be=e.x,Ae=e.aJ,Ee=e.dq,Se=e.ax,Ne=e.N,xe=e.av,Re=e.H,Ie=e.I,Pe=e.eu,ke=e.e1,Ce=e.fe,De=e.v,Me=e.am,Fe=e.cJ,Be=e.eb,Le=e.g,Oe=e.f,Ue=e.d,We=e.c,Ve=e.ff,je=e.fg,He=e.aR,ze=e.t,qe=e.aK,Ge=e.aL,Xe=e.$,Ye=e.aO,Qe=e.dP,Je=e.P,Ke=e.eM,Ze=e.di,$e=e.dH,et=e.c_,tt=e.fh,it=e.dG,nt=e.fi,rt=e.dK,st=e.ec,at=e.dc,ot=e.cR,ut=e.cS,ct=e.cT,ht=e.fj,lt=e.fk,dt=e.eL,ft=e.fl,pt=e.fm,mt=e.fn,_t=e.de,gt=e.fo,vt=e.c$,yt=e.fp,wt=e.fq,Tt=e.fr,bt=e.fs,At=e.ft,Et=e.fu,St=e.dy,Nt=e.fv,xt=e.fw,Rt=e.eQ,It=e.dA,Pt=e.fx,kt=e.m,Ct=e.fy,Dt=e.k,Mt=e.fz,Ft=e.dl,Bt=e.dk,Lt=e.dj,Ot=e.df,Ut=e.fA,Wt=e.fB,Vt=e.dm,jt=e.fC,Ht=e.fD,zt=e.fE,qt=e.fF,Gt=e.fG,Xt=e.fH,Yt=e.fI,Qt=e.fJ,Jt=e.fK,Kt=e.fL,Zt=e.fM,$t=e.fN,ei=e.fO,ti=e.i,ii=e.fP,ni=e.fQ,ri=e.fR,si=e.o,ai=e.dB,oi=e.fS,ui=e.n,ci=e.ee,hi=e.ej,li=e.ef,di=e.eg,fi=e.eh,pi=e.et,mi=e.fT,_i=e.bO,gi=e.bB,vi=e.T,yi=e.bL,wi=e.w,Ti=e.fU,bi=e.bU,Ai=e.fV,Ei=e.fW,Si=e.dQ},function(e){Ni=e.F,xi=e.Y,Ri=e.H,Ii=e.L,Pi=e.R,ki=e.e,Ci=e.w,Di=e.Z,Mi=e.G,Fi=e.r,Bi=e.m},function(){},function(e){Li=e.C},function(){},function(e){Oi=e.k,Ui=e.q,Wi=e.r,Vi=e.t,ji=e.H,Hi=e.c}],execute:function(){e({c:Gi,n:gs,o:vs,p:ys});var zi=Object.freeze({__proto__:null,bits:i,Vec2:n,v2:r,Vec3:s,v3:a,Vec4:o,v4:u,Quat:c,quat:h,Mat3:l,Mat4:d,mat4:f,AffineTransform:p,Size:m,size:_,Rect:g,rect:v,Color:y,color:w,EPSILON:T,equals:b,approx:A,clamp:E,clamp01:S,lerp:N,toRadian:x,toDegree:R,random:I,randomRange:P,randomRangeInt:k,pseudoRandom:C,pseudoRandomRange:D,pseudoRandomRangeInt:M,nextPow2:F,repeat:B,pingPong:L,inverseLerp:O,absMaxComponent:U,absMax:W,enumerableProps:V,MATH_FLOAT_ARRAY:j,MathBase:H});e("m",zi);var qi=Object.freeze({__proto__:null,distance:z,enums:q,intersect:G,Line:X,Plane:Y,Ray:Q,Triangle:J,Sphere:K,AABB:Z,OBB:$,Capsule:ee,Frustum:te,Keyframe:ie,AnimationCurve:ne,get ERaycastMode(){return re},line:se,plane:ae,ray:oe,triangle:ue,sphere:ce,aabb:he,obb:le,capsule:de,frustum:fe});function Gi(){var e=new Ni;return e.initialize({flows:[]}),e}e("g",qi);var Xi=new n,Yi=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.settings=window._CCSettings.splashScreen;t.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,t.base64src=this.settings.base64src||"",t.effect=this.settings.effect||"FADE-INOUT",t.clearColor=this.settings.clearColor||new me(.88,.88,.88,1),t.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,t.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new me(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{_e.view.enableRetina(!0),_e.view.resizeWithBrowserSize(!0);var i=window._CCSettings.designResolution;i?_e.view.setDesignResolutionSize(i.width,i.height,i.policy):_e.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,_e.game.once(_e.Game.EVENT_GAME_INITED,(function(){_e.director._lateUpdate=performance.now()}),_e.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else pe("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),_e.game.resume())},e.preInit=function(){var e=this.settings.clearColor;this.clearColors=[new me(e.x,e.y,e.z,e.w)];var t=this.device;this.renderArea=new ge(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),n=4*Float32Array.BYTES_PER_ELEMENT,r=4*n;this.vertexBuffers=t.createBuffer(new ve(ye.VERTEX|ye.TRANSFER_DST,we.HOST|we.DEVICE,r,n)),this.vertexBuffers.update(i);var s=new Uint16Array([0,1,2,1,3,2]),a=Uint16Array.BYTES_PER_ELEMENT,o=6*a;this.indicesBuffers=t.createBuffer(new ve(ye.INDEX|ye.TRANSFER_DST,we.HOST|we.DEVICE,o,a)),this.indicesBuffers.update(s);var u=[new Te("a_position",be.RG32F),new Te("a_texCoord",be.RG32F)],c=new Ae(u,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(c),this.projection=new d,d.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,t.surfaceTransform)},e.init=function(){var e=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),_e.game.pause(),this.handle=requestAnimationFrame((function t(i){if(!e.cancelAnimate){var n=e.settings,r=e.device;d.ortho(e.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,r.surfaceTransform);var s=r.width,a=r.height,o=s<a?s:a;e.startTime<0&&(e.startTime=i);var u=i-e.startTime,c=S(u/n.totalTime),h=Ce(c);"NONE"===n.effect&&(h=1);var l=e.logoTexture.width,f=e.logoTexture.height,p=o*n.displayRatio,m=p*l/f,_=p;if(r.surfaceTransform!==De.ROTATE_90&&r.surfaceTransform!==De.ROTATE_270||(m=p*s/a,_=p*f/l*a/s),e.logoMat.setProperty("resolution",Xi.set(s,a),0),e.logoMat.setProperty("scale",Xi.set(m,_),0),e.logoMat.setProperty("translate",Xi.set(.5*s,.5*a),0),e.logoMat.setProperty("precent",h),e.logoMat.setProperty("u_projection",e.projection),e.logoMat.passes[0].update(),n.displayWatermark&&e.watermarkMat){var g=.5*o,v=e.watermarkTexture.width,y=g,w=g*e.watermarkTexture.height/v;r.surfaceTransform!==De.ROTATE_90&&r.surfaceTransform!==De.ROTATE_270||(y=.5*g,w=g*s/a*.5),e.watermarkMat.setProperty("resolution",Xi.set(s,a),0),e.watermarkMat.setProperty("scale",Xi.set(y,w),0),e.watermarkMat.setProperty("translate",Xi.set(.5*s,.1*a),0),e.watermarkMat.setProperty("precent",h),e.watermarkMat.setProperty("u_projection",e.projection),e.watermarkMat.passes[0].update()}e.frame(),u>n.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.initLogo=function(){var e=this.device;this.logoMat=new Ee,this.logoMat.initialize({effectName:"splash-screen"});var t=new Se;t.addressU=Ne.CLAMP,t.addressV=Ne.CLAMP,t.addressW=Ne.CLAMP,this.sampler=e.createSampler(t),this.logoTexture=e.createTexture(new xe(Re.TEX2D,Ie.SAMPLED|Ie.TRANSFER_DST,be.RGBA8,this.logoImage.width,this.logoImage.height));var i=this.logoMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.logoTexture),this.shader=i.getShaderVariant();var r=i.descriptorSet;r.bindSampler(n,this.sampler),r.update();var s=new Me;s.texExtent.width=this.logoImage.width,s.texExtent.height=this.logoImage.height,s.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[s])},e.initWarterMark=function(){var e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=""+e.width,e.style.height=""+e.height;var t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var i="Powered by Cocos Creator",n=t.measureText(i);t.fillText(i,(330-n.width)/2,6);var r=new Me;r.texExtent.width=e.width,r.texExtent.height=e.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new xe(Re.TEX2D,Ie.SAMPLED|Ie.TRANSFER_DST,be.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[r]),this.watermarkMat=new Ee,this.watermarkMat.initialize({effectName:"splash-screen"});var s=this.watermarkMat.passes[0],a=s.getBinding("mainTexture");s.bindTexture(a,this.watermarkTexture),s.descriptorSet.update()},e.frame=function(){var e=this.device;e.acquire();var t=this.cmdBuff,i=this.framebuffer,n=this.renderArea;n.width=e.width,n.height=e.height,t.begin(),t.beginRenderPass(i.renderPass,i,n,this.clearColors,1,0);var r=this.logoMat.passes[0],s=xi.getOrCreatePipelineState(e,r,this.shader,i.renderPass,this.quadAssmebler);if(t.bindPipelineState(s),t.bindDescriptorSet(Pe.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var a=this.watermarkMat.passes[0],o=xi.getOrCreatePipelineState(e,a,this.shader,i.renderPass,this.quadAssmebler);t.bindPipelineState(o),t.bindDescriptorSet(Pe.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler)}t.endRenderPass(),t.end(),e.flushCommands([t]),e.queue.submit([t]),e.present()},e.destroy=function(){this.callBack=null,this.root=null,this.device=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,t._ins=void 0},ke(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();Yi._ins=void 0,_e.internal.SplashScreen=Yi;var Qi=e("h",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},ke(e,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}}]),e}());Qi.Priority=Fe({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});var Ji=new je("Scheduler"),Ki=function(e,t,i,n){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=i,this.markedForDeletion=n};Ki.get=function(e,t,i,n){var r=Ki._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=i,r.markedForDeletion=n):r=new Ki(e,t,i,n),r},Ki.put=function(e){Ki._listEntries.length<20&&(e.target=null,Ki._listEntries.push(e))},Ki._listEntries=[];var Zi=function(e,t,i,n){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=i,this.callback=n};Zi.get=function(e,t,i,n){var r=Zi._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=i,r.callback=n):r=new Zi(e,t,i,n),r},Zi.put=function(e){Zi._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,Zi._hashUpdateEntries.push(e))},Zi._hashUpdateEntries=[];var $i=function(e,t,i,n,r,s){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=s};$i.get=function(e,t,i,n,r,s){var a=$i._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s):a=new $i(e,t,i,n,r,s),a},$i.put=function(e){$i._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,$i._hashTimerEntries.push(e))},$i._hashTimerEntries=[];var en=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,i,n,r,s){return this._lock=!1,this._scheduler=e,this._target=i,this._callback=t,this._elapsed=-1,this._interval=n,this._delay=s,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===_e.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();en._timers=[],en.get=function(){return en._timers.pop()||new en},en.put=function(e){en._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,en._timers.push(e))};var tn=e("S",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=Ve(!0),t._hashForTimers=Ve(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}Be(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?Ue(1513):e.id=Ji.getNewId())};var i=t.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.getTimeScale=function(){return this._timeScale},i.update=function(e){var t,i,n,r,s;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,n=(i=this._updatesNegList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updates0List).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updatesPosList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(s=a[t],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(e),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updates0List;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updatesPosList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(e,t,i,n,r,s){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(s=!!n,n=_e.macro.REPEAT_FOREVER,r=0),Le(t,1502);var o=t.uuid||t.id;if(o){var u,c,h=this._hashForTimers[o];if(h?h.paused!==s&&Ue(1511):(h=$i.get(null,t,0,null,null,s),this._arrayForTimers.push(h),this._hashForTimers[o]=h),null==h.timers)h.timers=[];else for(c=0;c<h.timers.length;++c)if((u=h.timers[c])&&e===u._callback)return We(1507,u.getInterval(),i),void(u._interval=i);(u=en.get()).initWithCallback(this,e,t,i,n,r),h.timers.push(u),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else Oe(1510)},i.scheduleUpdate=function(e,t,i){var n=e.uuid||e.id;if(n){var r=this._hashForUpdates[n];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return We(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(e)}var s,a=Ki.get(e,t,i,!1);0===t?(s=this._updates0List,this._appendIn(s,a)):(s=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,a,t)),this._hashForUpdates[n]=Zi.get(s,a,e,null)}else Oe(1510)},i.unschedule=function(e,t){if(t&&e){var i=t.uuid||t.id;if(i){var n=this._hashForTimers[i];if(n)for(var r=n.timers,s=0,a=r.length;s<a;s++){var o=r[s];if(e===o._callback)return o!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(s,1),en.put(o),n.timerIndex>=s&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}else Oe(1510)}},i.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForUpdates[t];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else Oe(1510)}},i.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];if(i){var n=i.timers;n.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,s=n.length;r<s;r++)en.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(e)}else Oe(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(Qi.Priority.SCHEDULER)},i.unscheduleAllWithMinPriority=function(e){var t,i,n,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)i=r[t],this.unscheduleAllForTarget(i.target);var s=0;if(e<0)for(t=0;t<this._updatesNegList.length;)s=this._updatesNegList.length,(n=this._updatesNegList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),s===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)s=this._updates0List.length,(n=this._updates0List[t])&&this.unscheduleUpdate(n.target),s===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)s=this._updatesPosList.length,(n=this._updatesPosList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),s===this._updatesPosList.length&&t++},i.isScheduled=function(e,t){Le(e,1508),Le(t,1509);var i=t.uuid||t.id;if(!i)return Oe(1510),!1;var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,s=0;s<r.length;++s)if(e===r[s]._callback)return!0;return!1},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(Qi.Priority.SCHEDULER)},i.pauseAllTargetsWithMinPriority=function(e){var t,i,n,r,s=[],a=this._arrayForTimers;for(i=0,n=a.length;i<n;i++)(t=a[i])&&(t.paused=!0,s.push(t.target));if(e<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=e&&(r.paused=!0,s.push(r.target));if(e<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,s.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=e&&(r.paused=!0,s.push(r.target));return s},i.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},i.pauseTarget=function(e){Le(e,1503);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!0);var n=this._hashForUpdates[t];n&&(n.entry.paused=!0)}else Oe(1510)},i.resumeTarget=function(e){Le(e,1504);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!1);var n=this._hashForUpdates[t];n&&(n.entry.paused=!1)}else Oe(1510)},i.isTargetPaused=function(e){Le(e,1505);var t=e.uuid||e.id;if(!t)return Oe(1510),!1;var i=this._hashForTimers[t];if(i)return i.paused;var n=this._hashForUpdates[t];return!!n&&n.entry.paused},i._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var i=this._arrayForTimers,n=0,r=i.length;n<r;n++)if(i[n]===e){i.splice(n,1);break}$i.put(e)},i._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,i=this._hashForUpdates[t];if(i){for(var n=i.list,r=i.entry,s=0,a=n.length;s<a;s++)if(n[s]===r){n.splice(s,1);break}delete this._hashForUpdates[t],Ki.put(r),Zi.put(i)}},i._priorityIn=function(e,t,i){for(var n=0;n<e.length;n++)if(i<e[n].priority)return void e.splice(n,0,t);e.push(t)},i._appendIn=function(e,t){e.push(t)},t}(Qi));tn.ID="scheduler",_e.Scheduler=tn;var nn=function(){function e(){this._title="",this._width=1,this._height=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}};var t=e.prototype;return t._setHasOffScreenAttachments=function(e){this._hasOffScreenAttachments=e},t._setHasOnScreenAttachments=function(e){this._hasOnScreenAttachments=e},t._createFrameBuffer=function(e,t){this._framebuffer=e.createFramebuffer(new He(t,this._colorTextures,this._depthStencilTexture))},t._init=function(){},t.initialize=function(e,t){this._init(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height;for(var i=t.renderPassInfo,n=i.colorAttachments,r=i.depthStencilAttachment,s=0;s<n.length;s++)n[s].format===be.UNKNOWN&&(n[s].format=e.colorFormat);r&&r.format===be.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<n.length;a++){var o=null;this._swapchainBufferIndices&1<<a?this._setHasOnScreenAttachments(!0):(o=e.createTexture(new xe(Re.TEX2D,Ie.COLOR_ATTACHMENT|Ie.SAMPLED,n[a].format,this._width,this._height)),this._setHasOffScreenAttachments(!0)),this._colorTextures.push(o)}return r?this._swapchainBufferIndices>=0&&(this._depthStencilTexture=e.createTexture(new xe(Re.TEX2D,Ie.DEPTH_STENCIL_ATTACHMENT|Ie.SAMPLED,r.format,this._width,this._height)),this._setHasOffScreenAttachments(!0)):this._setHasOnScreenAttachments(!0),this._createFrameBuffer(e,this._renderPass),!0},t._destroy=function(){this.framebuffer.destroy()},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._destroy()},t.resize=function(e,t){this._width=e,this._height=t;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),i=!0);for(var n=0;n<this._colorTextures.length;n++){var r=this._colorTextures[n];r&&(r.resize(e,t),i=!0)}var s=this.framebuffer;i&&s&&(s.destroy(),s.initialize(new He(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(var a,o=ze(this._cameras);!(a=o()).done;){var u=a.value;u.isWindowSize&&u.resize(e,t)}},t.extractRenderCameras=function(e){for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t];i.enabled&&(i.update(),e.push(i))}},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},ke(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return this._hasOnScreenAttachments}},{key:"hasOffScreenAttachments",get:function(){return this._hasOffScreenAttachments}},{key:"cameras",get:function(){return this._cameras}},{key:"native",get:function(){return this._nativeObj}}]),e}(),rn=function(){var e=t.prototype;function t(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._device=e,this._dataPoolMgr=_e.internal.DataPoolManager&&new _e.internal.DataPoolManager(e),Pi.registerCreateFunc(this),nn.registerCreateFunc(this),this._cameraPool=new Je((function(){return new ki(t._device)}),4)}return e._init=function(){},e._destroy=function(){},e._setCumulativeTime=function(e){this._cumulativeTime+=e},e._setFrameTime=function(e){this._frameTime=e},e.initialize=function(){var e=this;this._init();var t=new qe,i=new Ge;i.depthStoreOp=Xe.DISCARD,i.stencilStoreOp=Xe.DISCARD;var n=new Ye([t],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:n,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(Qe.initBuiltinRes(this._device)).then((function(){_e.view.on("design-resolution-changed",(function(){var t=_e.game.canvas.width,i=_e.game.canvas.height;e.resize(t,i)}),e)}))},e.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._destroy()},e.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var i,n=ze(this._windows);!(i=n()).done;){var r=i.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}this._pipeline&&this._pipeline.resize(e,t)},e.setRenderPipeline=function(e){if(e instanceof Ri&&(this._useDeferredPipeline=!0),e||(e=Gi()),this._pipeline=e,!this._pipeline.activate())return!1;var t=_e.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&_e.internal.Batcher2D&&(this._batcher=new _e.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},e.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.onGlobalPipelineStateChanged()},e.activeWindow=function(e){this._curWindow=e},e.resetCumulativeTime=function(){this._setCumulativeTime(0)},e.frameMove=function(e){this._setFrameTime(e),++this._frameCount,this._setCumulativeTime(e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var t=0;t<this._scenes.length;++t)this._scenes[t].removeBatches();this._batcher&&this._batcher.update();for(var i=this._windows,n=[],r=0;r<i.length;r++)i[r].extractRenderCameras(n);if(this._pipeline&&n.length>0){this._device.acquire();var s=this._scenes,a=_e.director.getTotalFrames();this._batcher&&this._batcher.uploadBuffers();for(var o=0;o<s.length;o++)s[o].update(a);_e.director.emit(_e.Director.EVENT_BEFORE_COMMIT),n.sort((function(e,t){return e.priority-t.priority})),this._pipeline.render(n),this._device.present()}this._batcher&&this._batcher.reset()},e.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},e.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},e.destroyWindows=function(){for(var e,t=ze(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},e.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},e.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},e.destroyScenes=function(){for(var e,t=ze(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},e.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new Je((function(){return new e}),10)),t=this._modelPools.get(e));var i=t.alloc();return i.initialize(),i},e.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):Ue(1300,e.constructor.name)},e.createCamera=function(){return this._cameraPool.alloc()},e.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new Je((function(){return new e}),4)),t=this._lightPools.get(e));var i=t.alloc();return i.initialize(),i},e.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case Ii.SPHERE:e.scene.removeSphereLight(e);break;case Ii.SPOT:e.scene.removeSpotLight(e)}},ke(t,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(e){this._curWindow=e}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(e){this._tempWindow=e}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return this._cumulativeTime}},{key:"frameTime",get:function(){return this._frameTime}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),t}();_e.Root=rn;var sn=e("D",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._scheduler=new tn,t._compScheduler=new nt,t._nodeActivator=new rt,t._systems=[],Ci.once(Mi.EVENT_RENDERER_INITED,t._initOnRendererInitialized,st(t)),t}Be(t,e);var i=t.prototype;return i.calculateDeltaTime=function(){},i.convertToGL=function(e){var t=Ci.container,i=_e.view,n=t.getBoundingClientRect(),s=n.left+window.pageXOffset-t.clientLeft,a=n.top+window.pageYOffset-t.clientTop,o=i._devicePixelRatio*(e.x-s),u=i._devicePixelRatio*(a+n.height-e.y);return i._isRotated?r(i._viewportRect.width-u,o):r(o,u)},i.convertToUI=function(e){var t=Ci.container,i=_e.view,n=t.getBoundingClientRect(),s=n.left+window.pageXOffset-t.clientLeft,a=n.top+window.pageYOffset-t.clientTop,o=r(0,0);return i._isRotated?(o.x=s+e.y/i._devicePixelRatio,o.y=a+n.height-(i._viewportRect.width-e.x)/i._devicePixelRatio):(o.x=s+e.x*i._devicePixelRatio,o.y=a+n.height-e.y*i._devicePixelRatio),o},i.end=function(){var e=this;this.once(t.EVENT_END_FRAME,(function(){e.purgeDirector()}))},i.pause=function(){this._paused||(this._paused=!0)},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Ke&&Ke.setEnabled(!1),_e.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),_e.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),Ke&&Ke.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(e,t,i){e instanceof Ze&&(e=e.scene),Le(e instanceof $e,1216),e._load();for(var n=Object.keys(Ci._persistRootNodes).map((function(e){return Ci._persistRootNodes[e]})),r=0;r<n.length;r++){var s=n[r];s.emit(_e.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.uuid===s._originalSceneId&&e.getChildByUuid(s.uuid);if(a){var o=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(s,o)}else s.parent=e}var u=this._scene;_e.isValid(u)&&u.destroy(),_e.assetManager._releaseManager._autoRelease(u,e,Ci._persistRootNodes),this._scene=null,et._deferredDestroy(),t&&t(),this.emit(_e.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,e),this.emit(_e.Director.EVENT_AFTER_SCENE_LAUNCH,e)},i.runScene=function(e,t,i){var n=this;e instanceof Ze&&(e=e.scene),Le(e,1205),Le(e instanceof $e,1216),e._load(),this.once(_e.Director.EVENT_END_FRAME,(function(){n.runSceneImmediate(e,t,i)}))},i.loadScene=function(e,t,i){var n=this;if(this._loadingScene)return Ue(1208,e,this._loadingScene),!1;var r=_e.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));return r?(this.emit(_e.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,s){console.timeEnd("LoadScene "+e),n._loadingScene="",r?(pe(r),t&&t(r)):n.runSceneImmediate(s,i,t)})),!0):(Oe(1209,e),!1)},i.preloadScene=function(e,t,i){var n=_e.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));if(n)n.preloadScene(e,null,t,i);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';i&&i(new Error(r)),pe("preloadScene: "+r)}},i.resume=function(){this._paused&&(this._paused=!1)},i.getScene=function(){return this._scene},i.getDeltaTime=function(){return Ci.deltaTime},i.getTotalTime=function(){return Ci.totalTime},i.getCurrentTime=function(){return Ci.frameStartTime},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(tn.ID,e,200))},i.registerSystem=function(e,t,i){t.id=e,t.priority=i,t.init(),this._systems.push(t),this._systems.sort(Qi.sortByPriority)},i.unregisterSystem=function(e){tt.fastRemove(this._systems,e),this._systems.sort(Qi.sortByPriority)},i.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},i.getAnimationManager=function(){return this.getSystem(_e.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(e){var t;t=Ci._calculateDT(e),this.tick(t)},i.tick=function(e){if(!this._invalid){if(this.emit(t.EVENT_BEGIN_FRAME),Di.frameDispatchEvents(),!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(e);for(var i=0;i<this._systems.length;++i)this._systems[i].update(e);this._compScheduler.lateUpdatePhase(e),this.emit(t.EVENT_AFTER_UPDATE),et._deferredDestroy();for(var n=0;n<this._systems.length;++n)this._systems[n].postUpdate(e)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(e),this.emit(t.EVENT_AFTER_DRAW),Ke.frameUpdateListeners(),it.resetHasChangedFlags(),it.clearNodeArray(),this.emit(t.EVENT_END_FRAME),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._paused=!1,Ke&&Ke.setEnabled(!0),this.registerSystem(tn.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},i._init=function(){return this._root=new rn(Ci._gfxDevice),this._root.initialize({}).catch((function(e){return Oe(1217),Promise.reject(e)}))},ke(t,[{key:"root",get:function(){return this._root}}]),t}(at));sn.EVENT_INIT="director_init",sn.EVENT_RESET="director_reset",sn.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",sn.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",sn.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",sn.EVENT_BEFORE_UPDATE="director_before_update",sn.EVENT_AFTER_UPDATE="director_after_update",sn.EVENT_BEFORE_DRAW="director_before_draw",sn.EVENT_AFTER_DRAW="director_after_draw",sn.EVENT_BEFORE_COMMIT="director_before_commit",sn.EVENT_BEFORE_PHYSICS="director_before_physics",sn.EVENT_AFTER_PHYSICS="director_after_physics",sn.EVENT_BEGIN_FRAME="director_begin_frame",sn.EVENT_END_FRAME="director_end_frame",sn.instance=void 0,_e.Director=sn;var an=e("d",sn.instance=_e.director=new sn),on={};ot(on,"vmath",[{name:"vec2",newName:"Vec2",target:zi,targetName:"math"},{name:"vec3",newName:"Vec3",target:zi,targetName:"math"},{name:"vec4",newName:"Vec4",target:zi,targetName:"math"},{name:"quat",newName:"Quat",target:zi,targetName:"math"},{name:"mat3",newName:"Mat3",target:zi,targetName:"math"},{name:"mat4",newName:"Mat4",target:zi,targetName:"math"},{name:"color4",newName:"Color",target:zi,targetName:"math"},{name:"rect",newName:"Rect",target:zi,targetName:"math"},{name:"approx",newName:"approx",target:zi,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:zi,targetName:"math"},{name:"equals",newName:"equals",target:zi,targetName:"math"},{name:"clamp",newName:"clamp",target:zi,targetName:"math"},{name:"clamp01",newName:"clamp01",target:zi,targetName:"math"},{name:"lerp",newName:"lerp",target:zi,targetName:"math"},{name:"toRadian",newName:"toRadian",target:zi,targetName:"math"},{name:"toDegree",newName:"toDegree",target:zi,targetName:"math"},{name:"random",newName:"random",target:zi,targetName:"math"},{name:"randomRange",newName:"randomRange",target:zi,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:zi,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:zi,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:zi,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:zi,targetName:"math"},{name:"repeat",newName:"repeat",target:zi,targetName:"math"},{name:"pingPong",newName:"pingPong",target:zi,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:zi,targetName:"math"}]),_e.vmath=on,ot(tn.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:tn,targetName:"Scheduler"}]),ot(tn,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:function(){return Qi.Priority.SCHEDULER}}]),ut(tn,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),ot(Fi.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:Fi,targetName:"EventTouch"}]),ot(Bi.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),ut(Bi.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),ot(rn.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),ct(Ci,"game",[{name:"collisionMatrix"},{name:"groupList"}]),ct(sn.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),ut(sn.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"}]);var un=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new ht,this.scenes=new ht,this.paths=new ht}var t=e.prototype;return t.init=function(e){var t=this;!function(e){var t=e.uuids,i=e.paths,n=e.types,r=e.deps,s=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,o=t.length;a<o;a++)t[a]=ft(t[a]);for(var u in i){var c=i[u],h=c[1];c[1]=n[h]}}else{for(var l=Object.create(null),d=0,f=t.length;d<f;d++){var p=t[d];t[d]=l[p]=ft(p)}t=l}for(var m in i){var _=i[m];s[t[m]]=_}var g=e.scenes;for(var v in g){var y=g[v];g[v]=t[y]}var w=e.packs;for(var T in w)for(var b=w[T],A=0;A<b.length;++A)b[A]=t[b[A]];var E=e.versions;if(E)for(var S in E)for(var N=E[S],x=0;x<N.length;x+=2){var R=N[x];N[x]=t[R]||R}var I=e.redirect;if(I)for(var P=0;P<I.length;P+=2)I[P]=t[I[P]],I[P+1]=r[I[P+1]];if(e.extensionMap){var k=function(i){if(!Object.prototype.hasOwnProperty.call(e.extensionMap,i))return"continue";e.extensionMap[i].forEach((function(n,r){e.extensionMap[i][r]=t[n]||n}))};for(var C in e.extensionMap)k(C)}}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect);var i=function(i){if(!Object.prototype.hasOwnProperty.call(e.extensionMap,i))return"continue";e.extensionMap[i].forEach((function(e){var n=t.assetInfos.get(e);n&&(n.extension=i)}))};for(var n in e.extensionMap)i(n)},t.getInfoWithPath=function(e,t){if(!e)return null;e=lt(e);var i=this.paths.get(e);if(i){if(!t)return i[0];for(var n=0,r=i.length;n<r;n++){var s=i[n];if(dt.isChildClassOf(s.ctor,t))return s}}return null},t.getDirWithPath=function(e,t,i){"/"===(e=lt(e))[e.length-1]&&(e=e.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var s=0,a=i.length;s<a;s++){var o=i[s];t&&!dt.isChildClassOf(o.ctor,t)||n.push(o)}})),n},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,i){return i.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,i=e.length;t<i;t++){var n=e[t];this.assetInfos.add(n,{uuid:n})}}},t._initPath=function(e){if(e){var t=this.paths;for(var i in t.clear(),e){var n=e[i],r=n[0],s=n[1],a=3===n.length,o=this.assetInfos.get(i);o.path=r,o.ctor=dt._getClassById(s),t.has(r)?a?t.get(r).push(o):t.get(r).unshift(o):t.add(r,[o])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var i=this.assetInfos;for(var n in e){var r=e[n],s=i.get(r);s.url=n,t.add(n,s)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var i in e){var n=e[i],r={uuid:i,packedUuids:n,ext:".json"};t.add(i,r);for(var s=0,a=n.length;s<a;s++){var o=n[s],u=t.get(o),c=u.packs;c?1===a?c.unshift(r):c.push(r):u.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,i=e.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var s=i[n];t.get(s).ver=i[n+1]}if(i=e.native)for(var a=0,o=i.length;a<o;a+=2){var u=i[a];t.get(u).nativeVer=i[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,i=0,n=e.length;i<n;i+=2){var r=e[i];t.get(r).redirect=e[i+1]}},e}();function cn(e,t){e._uuid&&t.push(e._uuid)}function hn(e,t){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var s=e[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var a=0;a<s.length;a++){var o=s[a];o instanceof _t&&cn(o,t)}else if(s.constructor&&s.constructor!==Object)s instanceof _t&&cn(s,t);else for(var u=Object.getOwnPropertyNames(s),c=0;c<u.length;c++){var h=s[u[c]];h instanceof _t&&cn(h,t)}}}}function ln(e,t){for(var i=0;i<e._components.length;i++)hn(e._components[i],t);for(var n=0;n<e._children.length;n++)ln(e._children[n],t)}function dn(e,t,i,n){i.push(e._uuid);for(var r=mt.getDeps(e._uuid),s=0,a=r.length;s<a;s++){var o=pt.get(r[s]);if(o){var u=o._uuid;u in t?t[u]+=n:t[u]=o.refCount+n,i.includes(u)||dn(o,t,i,n)}}}var fn=[],pn=new(function(){function e(){this._persistNodeDeps=new ht,this._toDelete=new ht,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];ln(e,t);for(var i=0,n=t.length;i<n;i++){var r=pt.get(t[i]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),i=0,n=t.length;i<n;i++){var r=pt.get(t[i]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,i){if(e){for(var n=mt.getDeps(e.uuid),r=0,s=n.length;r<s;r++){var a=pt.get(n[r]);a&&a.decRef(e.autoReleaseAssets)}var o=mt._depends.get(e.uuid);if(o&&o.persistDeps)for(var u=o.persistDeps,c=0,h=u.length;c<h;c++){var l=pt.get(u[c]);l&&l.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&mt.remove(e.uuid)}var d=mt._depends.get(t.uuid);for(var f in d&&(d.persistDeps=[]),i){for(var p,m,_=i[f],g=this._persistNodeDeps.get(_.uuid),v=ze(g);!(m=v()).done;){var y=m.value,w=pt.get(y);w&&w.addRef()}d&&(p=d.persistDeps).push.apply(p,g)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof _t&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,gt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var i=e._uuid;if(this._toDelete.remove(i),vt(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,dn(e,t,fn,-1),fn.length=0,0!==t[e._uuid])return t[e._uuid];for(var i in t)0!==t[i]&&dn(pt.get(i),t,fn,1);return fn.length=0,t[e._uuid]}(e)>0)){pt.remove(i);for(var n=mt.getDeps(i),r=0,s=n.length;r<s;r++){var a=pt.get(n[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),mt.remove(i)}},e}()),mn=null;function _n(e,t){for(var i=0,n=e.input.length;i<n;i++){var r=e.input[i];t&&!r.isNative&&r.content instanceof _t&&r.content.decRef(!1),r.recycle()}e.input=null}function gn(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function vn(e,t,i,n,r){void 0===r&&(r=0),e(r,(function(s,a){r++,!s||r>t?n&&n(s,a):setTimeout((function(){vn(e,t,i,n,r)}),i)}))}function yn(e,t,i,n,r){try{for(var s=mt.parse(e,t),a=0,o=s.deps.length;a<o;a++){var u=s.deps[a];u in i||(i[u]=!0,n.push({uuid:u,bundle:r&&r.name}))}s.nativeDep&&(r&&(s.nativeDep.bundle=r.name),n.push(yt({},s.nativeDep)))}catch(e){pe(e.message,e.stack)}}function wn(e,t,i){t&&(i=void 0!==i?i:_e.assetManager.cacheAsset,wt(t)||!i||t.isDefault||pt.add(e,t))}function Tn(e,t,i){var n=0,r=[],s=e.length;0===s&&i&&i(r);for(var a=function(e){e&&r.push(e),++n===s&&i&&i(r)},o=0;o<s;o++)t(e[o],a)}function bn(e,t,i){var n=e,r=t,s=i;if(void 0===i){var a="function"==typeof e;t?(s=t,a||(r=null)):void 0===t&&a&&(s=e,n=null,r=null),void 0!==t&&a&&(r=e,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:s}}function An(e,t,i){var n=e,r=t,s=i;if(void 0===i){var a=dt.isChildClassOf(e,_t);t?(s=t,a&&(r=null)):void 0!==t||a||(s=e,r=null,n=null),void 0===t||a||(r=e,n=null)}return{type:n,onProgress:r||mn,onComplete:s}}function En(e,t,i,n){if(void 0===n&&(n={}),!i[t]||n[t])return!1;n[t]=!0;var r=!1,s=mt.getDeps(t);if(s)for(var a=0,o=s.length;a<o;a++){var u=s[a];if(u===e||En(e,u,i,n)){r=!0;break}}return r}function Sn(e){return function(t,i){if(e){var n=[];Array.isArray(i)?i.forEach((function(e){return e instanceof _t&&n.push(e.addRef())})):i instanceof _t&&n.push(i.addRef()),gt((function(){n.forEach((function(e){return e.decRef(!1)})),e(t,i)}))}}}var Nn=function(){function e(){this._config=new un}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,i){return this._config.getDirWithPath(e,t,i)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),At.add(e.name,this)},t.load=function(e,t,i,n){var r=An(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete,u={__requestType__:Et.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(e)};_e.assetManager.loadAny(e,u,a,o)},t.preload=function(e,t,i,n){var r=An(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;_e.assetManager.preloadAny(e,{__requestType__:Et.PATH,type:s,bundle:this.name},a,o)},t.loadDir=function(e,t,i,n){var r=An(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;_e.assetManager.loadAny(e,{__requestType__:Et.DIR,type:s,bundle:this.name,__outputAsArray__:!0},a,o)},t.preloadDir=function(e,t,i,n){var r=An(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;_e.assetManager.preloadAny(e,{__requestType__:Et.DIR,type:s,bundle:this.name},a,o)},t.loadScene=function(e,t,i,n){var r=bn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,_e.assetManager.loadAny({scene:e},s,a,(function(e,t){if(e)pe(e.message,e.stack);else if(t instanceof Ze&&t.scene){var i=t.scene;i._id=t._uuid,i.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");o&&o(e,t)}))},t.preloadScene=function(e,t,i,n){var r=bn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.bundle=this.name,_e.assetManager.preloadAny({scene:e},s,a,(function(t){t&&Oe(1210,e,t.message),o&&o(t)}))},t.get=function(e,t){var i=this.getInfoWithPath(e,t);return i&&pt.get(i.uuid)||null},t.release=function(e,t){var i=this.get(e,t);i&&pn.tryRelease(i,!0)},t.releaseUnusedAssets=function(){var e=this;pt.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&pn.tryRelease(t)}))},t.releaseAll=function(){var e=this;pt.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&pn.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},ke(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),xn=e("r",new Nn);function Rn(e,t,i){var n=new Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(null,n)}function s(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(new Error(St(4930,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",s),n.src=e,n}function In(e,t,i,n){var r=new XMLHttpRequest,s="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+s+r.status+"(no response)"))},i&&(r.onprogress=function(e){e.lengthComputable&&i(e.loaded,e.total)}),r.onerror=function(){n&&n(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+s+r.status+"(abort)"))},r.send(null),r}_e.resources=xn;var Pn={};function kn(e,t,i){if(Pn[e])return i&&i(null),null;var n=document.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),Pn[e]=!0,i&&i(null)}function s(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),i&&i(new Error(St(4928,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.async=t.scriptAsyncLoading||!1,n.src=e,n.addEventListener("load",r,!1),n.addEventListener("error",s,!1),document.body.appendChild(n),n}var Cn=/^(?:\w+:\/\/|\.+\/).+/,Dn=function(e,t,i){(It.capabilities.imageBitmap&&_e.assetManager.allowImageBitmap?Mn:Rn)(e,t,i)},Mn=function(e,t,i){t.xhrResponseType="blob",In(e,t,t.onFileProgress,i)},Fn=function(e,t,i){t.xhrResponseType="json",In(e,t,t.onFileProgress,i)},Bn=function(e,t,i){t.xhrResponseType="arraybuffer",In(e,t,t.onFileProgress,i)},Ln=function(e,t,i){Fn(e,t,(function(t,n){if(t)i(t);else{var r=Pt(n);Promise.all(r.chunks.map((function(i){return new Promise((function(n,r){Bn(""+kt(e)+i,{},(function(e,i){t?r(t):n(new Uint8Array(i))}))}))}))).then((function(e){var t=new Mt(r.document,e);i(null,t)})).catch((function(e){i(e)}))}}))},On=function(e,t,i){Bn(e,t,(function(e,t){if(e)i(e);else try{var n=Ct(new Uint8Array(t));i(null,n)}catch(e){i(e)}}))},Un=function(e,t,i){t.xhrResponseType="text",In(e,t,t.onFileProgress,i)},Wn=function(e,t,i){var n=Dt(e),r=e;Cn.test(r)||(r=-1!==jn.remoteBundles.indexOf(n)?jn.remoteServerAddress+"remote/"+n:"assets/"+n);var s=t.version||jn.bundleVers[n],a=0,o=null,u=null;Fn(r+"/config."+(s?s+".":"")+"json",t,(function(e,t){u=e,(o=t)&&(o.base=r+"/"),2==++a&&i(u,o)})),kn(r+"/index."+(s?s+".":"")+"js",t,(function(e){u=e,2==++a&&i(e,o)}))},Vn=function(){function e(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!!Rt,this.limited=!Rt,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=Rn,this.downloadDomAudio=null,this.downloadFile=In,this.downloadScript=kn,this._downloaders={".png":Dn,".jpg":Dn,".bmp":Dn,".jpeg":Dn,".gif":Dn,".ico":Dn,".tiff":Dn,".webp":Dn,".image":Dn,".pvr":Bn,".pkm":Bn,".astc":Bn,".txt":Un,".xml":Un,".vsh":Un,".fsh":Un,".atlas":Un,".tmx":Un,".tsx":Un,".json":Fn,".ExportJson":Fn,".plist":Un,".ccon":Ln,".cconb":On,".fnt":Un,".binary":Bn,".bin":Bn,".dbbin":Bn,".skel":Bn,".js":kn,bundle:Wn,default:Un},this._downloading=new ht,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var t=e.prototype;return t.init=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=i},t.register=function(e,t){"object"==typeof e?Nt(this._downloaders,e):this._downloaders[e]=t},t.download=function(e,t,i,n,r){var s=this,a=xt.get(e);if(a)r(null,a);else{var o=this._downloading.get(e);if(o){o.push(r);var u=this._queue.find((function(t){return t.id===e}));if(!u)return;var c=n.priority||0;u.priority<c&&(u.priority=c,this._queueDirty=!0)}else{var h=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,l=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,d=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[i]||this._downloaders.default;vn((function(i,a){if(0===i&&s._downloading.add(e,[r]),s.limited){s._updateTime();var o=function(e,t){s._totalNum--,s._handleQueueInNextFrame(l,d),a(e,t)};s._totalNum<l&&s._totalNumThisPeriod<d?(f(gn(t,s.appendTimeStamp),n,o),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:e,priority:n.priority||0,url:t,options:n,done:o,handler:f}),s._queueDirty=!0,s._totalNum<l&&s._handleQueueInNextFrame(l,d))}else f(gn(t,s.appendTimeStamp),n,a)}),h,this.retryInterval,(function(t,i){t||xt.add(e,i);for(var n=s._downloading.remove(e),r=0,a=n.length;r<a;r++)n[r](t,i)}))}}},t.loadSubpackage=function(e,t){_e.assetManager.loadBundle(e,null,t)},t._updateTime=function(){var e=performance.now(),t=_e.game.deltaTime,i=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=e)},t._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(gn(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(e,t)},t._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(gt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},ke(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),jn=e("s",new Vn);function Hn(e,t,i,n){var r=null,s=null;try{(r=new Ft)._nativeUrl=e,r._nativeAsset=t}catch(e){s=e}n(s,r)}function zn(e,t,i,n){var r=new Bt;r.json=t,n(null,r)}function qn(e,t,i,n){var r=new Lt;r.text=t,n(null,r)}function Gn(e,t,i,n){var r=new Ot;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function Xn(e,t,i,n){var r=new _t;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function Yn(e,i,n,r){var s=At.get(i.name);s||(s=i.name===Ut.RESOURCES?xn:new Nn,i.base=i.base||e+"/",s.init(i)),t.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}var Qn=function(){function e(){this._creating=new ht,this._producers={".png":Hn,".jpg":Hn,".bmp":Hn,".jpeg":Hn,".gif":Hn,".ico":Hn,".tiff":Hn,".webp":Hn,".image":Hn,".pvr":Hn,".pkm":Hn,".txt":qn,".xml":qn,".vsh":qn,".fsh":qn,".atlas":qn,".tmx":qn,".tsx":qn,".fnt":qn,".json":zn,".ExportJson":zn,".binary":Gn,".bin":Gn,".dbbin":Gn,".skel":Gn,bundle:Yn,default:Xn}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?dt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,i,n,r){var s=this,a=this._producers[i]||this._producers.default,o=pt.get(e);if(n.reloadAsset||!o){var u=this._creating.get(e);u?u.push(r):(this._creating.add(e,[r]),a(e,t,n,(function(t,i){!t&&i instanceof _t&&(i._uuid=e,wn(e,i,n.cacheAsset));for(var r=s._creating.remove(e),a=0,o=r.length;a<o;a++)r[a](t,i)})))}else r(null,o)},e}(),Jn=e("t",new Qn),Kn=new(function(){function e(){this._loading=new ht,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,n){var r=dt.createMap(!0),s=null;if(Array.isArray(t)){(t=Wt(t)).length!==e.length&&Oe(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var o=dt._getClassId(Vt),u=dt._getClassId(Ft);if(t.type===o&&t.data){var c=t.data;c.length!==e.length&&Oe(4915);for(var h=0;h<e.length;h++)r[e[h]+"@import"]=jt(o,{base:c[h][0],mipmaps:c[h][1]})}else if(t.type===u&&t.data){var l=t.data;l.length!==e.length&&Oe(4915);for(var d=0;d<e.length;d++)r[e[d]+"@import"]=l[d]}else s=new Error("unmatched type pack!"),r=null}n(s,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?dt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,n,r){t?(0,this._unpackers[i])(e,t,n,r):r(new Error("package data is wrong!"))},t.load=function(e,t,i){var n=this;if(!e.isNative&&e.info&&e.info.packs)if(xt.has(e.id))i(null,xt.get(e.id));else{var r=e.info.packs,s=r.find((function(e){return n._loading.has(e.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:e.id});else{s=r[0],this._loading.add(s.uuid,[{onComplete:i,id:e.id}]);var a=Ht(s.uuid,{ext:s.ext,bundle:e.config.name});jn.download(s.uuid,a,s.ext,e.options,(function(t,i){xt.remove(s.uuid),t&&pe(t.message,t.stack),n.unpack(s.packedUuids,i,s.ext,e.options,(function(e,i){if(!e)for(var r in i)xt.add(r,i[r]);for(var a=n._loading.remove(s.uuid),o=0,u=a.length;o<u;o++){var c=a[o];if(t||e)c.onComplete(t||e);else{var h=i[c.id];h?c.onComplete(null,h):c.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else jn.download(e.id,e.url,e.ext,e.options,i)},e}());function Zn(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress,s=[],a=r.total,o=n.__exclude__=n.__exclude__||Object.create(null);e.output=[],Tn(e.input,(function(n,u){if(!n.isNative&&pt.has(n.uuid)){var c=pt.get(n.uuid);return n.content=c.addRef(),e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n),void u()}Kn.load(n,e.options,(function(c,h){c?e.isFinish||(!_e.assetManager.force||i?(pe(c.message,c.stack),r.canInvoke=!1,t(c)):(e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n))):e.isFinish||(n.file=h,e.output.push(n),n.isNative||(o[n.uuid]=!0,yn(n.uuid,h,o,s,n.config),r.total=a+s.length),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n)),u()}))}),(function(){if(e.isFinish)return _n(e,!0),void e.dispatch("error");if(s.length>0){var a=zt.create({input:s,progress:r,options:n,onProgress:e.onProgress,onError:zt.prototype.recycle,onComplete:function(n){var r;n||((r=e.output).push.apply(r,a.output),a.recycle()),i&&$n(e),t(n)}});qt.async(a)}else i&&$n(e),t()}))}function $n(e){for(var t=e.output,i=0,n=t.length;i<n;i++)t[i].content&&t[i].content.decRef(!1)}var er=new(function(e){function t(){return e.apply(this,arguments)||this}Be(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return Ue(5100),{};for(var i=null,n=0,r=t.childNodes.length;n<r&&1!==(i=t.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&t.push(this._parseNode(r))}return t},i._parseDict=function(e){for(var t={},i="",n=0,r=e.childNodes.length;n<r;n++){var s=e.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:t[i]=this._parseNode(s))}return t},t}(e("v",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function tr(e,t){return e[t]<<8|e[t+1]}var ir=new(function(){function e(){this._parsing=new ht,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parsePVRTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(s,0,13);if(55727696===a[0]){var o=a[7],u=a[6],c=a[12]+52;r={_data:new Uint8Array(s,c),_compressed:!0,width:o,height:u,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var h=a[0],l=a[1],d=a[2];r={_data:new Uint8Array(s,h),_compressed:!0,width:d,height:l,format:0}}}catch(e){n=e}i(n,r)},t.parsePKMTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(s),o=tr(a,6);if(0!==o&&1!==o&&3!==o)throw new Error("Invalid magic number in ETC header");var u=tr(a,12),c=tr(a,14);tr(a,8),tr(a,10),r={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:c,format:0}}catch(e){n=e}i(n,r)},t.parseASTCTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(s);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var o=a[4],u=a[5],c=a[6];if((o<3||o>6||u<3||u>6||c<3||c>6)&&(o<4||7===o||9===o||11===o||o>12||u<4||7===u||9===u||11===u||u>12||1!==c))throw new Error("Invalid block number in ASTC header");var h=function(e,t){return 4===e?Yt.RGBA_ASTC_4x4:5===e?4===t?Yt.RGBA_ASTC_5x4:Yt.RGBA_ASTC_5x5:6===e?5===t?Yt.RGBA_ASTC_6x5:Yt.RGBA_ASTC_6x6:8===e?5===t?Yt.RGBA_ASTC_8x5:6===t?Yt.RGBA_ASTC_8x6:Yt.RGBA_ASTC_8x8:10===e?5===t?Yt.RGBA_ASTC_10x5:6===t?Yt.RGBA_ASTC_10x6:8===t?Yt.RGBA_ASTC_10x8:Yt.RGBA_ASTC_10x10:10===t?Yt.RGBA_ASTC_12x10:Yt.RGBA_ASTC_12x12}(o,u),l=a[7]+(a[8]<<8)+(a[9]<<16),d=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(s,16),_compressed:!0,width:l,height:d,format:h}}catch(e){n=e}i(n,r)},t.parsePlist=function(e,t,i){var n=null,r=er.parse(e);r||(n=new Error("parse failed")),i(n,r)},t.parseImport=function(e,t,i){if(e){var n=null,r=null;try{n=Gt(e,t)}catch(e){r=e}i(r,n)}else i(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Nt(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,n,r){var s=this,a=Xt.get(e);if(a)r(null,a);else{var o=this._parsing.get(e);if(o)o.push(r);else{var u=this._parsers[i];u?(this._parsing.add(e,[r]),u(t,n,(function(t,i){t?xt.remove(e):wt(i)||Xt.add(e,i);for(var n=s._parsing.remove(e),r=0,a=n.length;r<a;r++)n[r](t,i)}))):r(null,t)}}},e}());function nr(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],Tn(e.input,(function(s,a){var o=zt.create({input:s,onProgress:e.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!e.isFinish&&(!_e.assetManager.force||i?(pe(n.message,n.stack),r.canInvoke=!1,t(n)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,s)),e.output.push(u),o.recycle(),a(null)}});rr.async(o)}),(function(){if(n.__exclude__=null,e.isFinish)return _n(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var i=e.output=[],n=0,r=t.length;n<r;n++)i.push(t[n].content);else e.output=t[0].content}(e),_n(e,!0),t()}))}var rr=new Qt("loadOneAsset",[function(e,t){var i=e.output=e.input,n=i.options,r=i.isNative,s=i.uuid,a=i.file,o=n.reloadAsset;a||!o&&!r&&pt.has(s)?t():Kn.load(i,e.options,(function(e,n){i.file=n,t(e)}))},function(e,t){var i=e.output=e.input,n=e.progress,r=e.options.__exclude__,s=i.id,a=i.file,o=i.options;if(i.isNative)ir.parse(s,a,i.ext,o,(function(r,a){r?t(r):(i.content=a,n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),xt.remove(s),Xt.remove(s),t())}));else{var u=i.uuid;if(u in r){var c=r[u],h=c.finish,l=c.content,d=c.err,f=c.callbacks;n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),h||En(u,u,r)?(l&&l.addRef(),i.content=l,t(d)):f.push({done:t,item:i})}else if(!o.reloadAsset&&pt.has(u)){var p=pt.get(u);i.content=p.addRef(),n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),t()}else o.__uuid__=u,ir.parse(s,a,"import",o,(function(i,n){i?t(i):function(e,t,i){var n=e.input,r=e.progress,s=n,a=s.uuid,o=s.id,u=s.options,c=s.config,h=u.cacheAsset,l=[];t.addRef&&t.addRef(),yn(a,t,Object.create(null),l,c),r.canInvoke&&e.dispatch("progress",++r.finish,r.total+=l.length,n);var d=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:i,item:n}]},f=zt.create({input:l,options:e.options,onProgress:e.onProgress,onError:zt.prototype.recycle,progress:r,onComplete:function(e){if(t.decRef&&t.decRef(!1),d.finish=!0,d.err=e,!e){for(var i,n=Array.isArray(f.output)?f.output:[f.output],r=Object.create(null),s=ze(n);!(i=s()).done;){var u=i.value;u&&(r[u instanceof _t?u._uuid+"@import":a+"@native"]=u)}!function(e,t,i){var n=Tt.get(t);if(n){for(var r=0,s=n.length;r<s;r++){var a=n[r],o=i[a.uuid+"@import"];if(o)a.owner[a.prop]=o.addRef();else{if(pe("The asset "+a.uuid+" is missing!"),a.type&&a.type!==_t){var u=new a.type;u.initDefault(a.uuid),a.owner[a.prop]=u}!0}}Tt.delete(t)}bt.has(t)&&(i[e+"@native"]?t._nativeAsset=i[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),bt.delete(t))}(a,t,r);try{"function"!=typeof t.onLoaded||Jt.has(t)||bt.has(t)||(t.onLoaded(),Jt.add(t))}catch(e){pe("The asset "+a+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}xt.remove(o),Xt.remove(o),wn(a,t,h),f.recycle()}for(var c=d.callbacks,l=0,p=c.length;l<p;l++){var m=c[l];t.addRef&&t.addRef(),m.item.content=t,m.done(e)}c.length=0}});Kt.async(f)}(e,n,t)}))}}]);function sr(e,t){var i=e.options,n=Object.create(null),r=Object.create(null);for(var s in i)switch(s){case Et.PATH:case Et.UUID:case Et.DIR:case Et.SCENE:case Et.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[s]=i[s];break;case"__exclude__":case"__outputAsArray__":r[s]=i[s];break;default:n[s]=i[s],r[s]=i[s]}e.options=r;var a=zt.create({input:e.input,options:n}),o=null;try{e.output=e.source=Zt.sync(a)}catch(e){o=e;for(var u=0,c=a.output.length;u<c;u++)a.output[u].recycle()}a.recycle(),t(o)}var ar=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},ke(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();ar.MAX_DEAD_NUM=500,ar._deadPool=[];var or=[];function ur(e){var t=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var n=function(n){var r,s=i[n],a=ar.create(),o=null,u=null;if("string"==typeof s&&((s=Object.create(null))[t.__requestType__||Et.UUID]=i[n]),"object"==typeof s)for(var c in $t(s,t),s.preset&&$t(s,ei[s.preset]),s){switch(c){case Et.UUID:if("break"===function(){var e,t=a.uuid=ft(s.uuid);if(!s.bundle){var i=At.find((function(e){return!!e.getAssetInfo(t)}));s.bundle=i&&i.name}if(At.has(s.bundle)){if(o=At.get(s.bundle).config,(u=o.getAssetInfo(t))&&u.redirect){if(!At.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");o=At.get(u.redirect).config,u=o.getAssetInfo(t)}a.config=o,a.info=u}return a.ext=s.ext||(null===(e=u)||void 0===e?void 0:e.extension)||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Et.DIR:if(At.has(s.bundle)){At.get(s.bundle).config.getDirWithPath(s.dir,s.type,or);for(var h,l=ze(or);!(h=l()).done;){var d=h.value;i.push({uuid:d.uuid,__isNative__:!1,ext:d.extension||".json",bundle:s.bundle})}or.length=0}a.recycle(),a=null;break;case Et.PATH:if(At.has(s.bundle)){if(o=At.get(s.bundle).config,(u=o.getInfoWithPath(s.path,s.type))&&u.redirect){if(!At.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");o=At.get(u.redirect).config,u=o.getAssetInfo(u.uuid)}if(!u)throw a.recycle(),new Error("Bundle "+s.bundle+" doesn't contain "+s.path);a.config=o,a.uuid=u.uuid,a.info=u}a.ext=s.ext||(null===(r=u)||void 0===r?void 0:r.extension)||".json";break;case Et.SCENE:if(!s.bundle){var f=At.find((function(e){return!!e.getSceneInfo(s.scene)}));s.bundle=f&&f.name}if(At.has(s.bundle)){if(o=At.get(s.bundle).config,(u=o.getSceneInfo(s.scene))&&u.redirect){if(!At.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");o=At.get(u.redirect).config,u=o.getAssetInfo(u.uuid)}if(!u)throw a.recycle(),new Error("Bundle "+o.name+" doesn't contain scene "+s.scene);a.config=o,a.uuid=u.uuid,a.info=u}break;case"__isNative__":a.isNative=s.__isNative__;break;case Et.URL:a.url=s.url,a.uuid=s.uuid||s.url,a.ext=s.ext||ti(s.url),a.isNative=void 0===s.__isNative__||s.__isNative__;break;default:a.options[c]=s[c]}if(!a)break}if(!a)return"continue";if(e.output.push(a),!a.uuid&&!a.url)throw new Error("Can not parse this input:"+JSON.stringify(s))},r=0;r<i.length;r++)n(r);return null}function cr(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var n=t[i];if(!n.url){var r,s,a=n.config;s=n.isNative?a&&a.nativeBase?a.base+a.nativeBase:_e.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:_e.assetManager.generalImportBase;var o=n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?s+"/"+o.slice(0,2)+"/"+o+u+"/"+n.options.__nativeName__:s+"/"+o.slice(0,2)+"/"+o+u+n.ext,n.url=r}}return null}var hr=e("A",function(){function e(){this.pipeline=Kt.append(sr).append(nr),this.fetchPipeline=qt.append(sr).append(Zn),this.transformPipeline=Zt.append(ur).append(cr),this.bundles=At,this.assets=pt,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=mt,this.force=ii,this.allowImageBitmap=!It.isMobile,this.utils=ni,this.downloader=jn,this.parser=ir,this.packManager=Kn,this.cacheAsset=!0,this.cacheManager=null,this.presets=ei,this.factory=Jn,this.preprocessPipe=sr,this.fetchPipe=Zn,this.loadPipe=nr,this.references=ri,this._releaseManager=pn,this._files=xt,this._parsed=Xt,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var i=e.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=t,this.generalNativeBase=i},t.getBundle=function(e){return At.get(e)||null},t.removeBundle=function(e){e._destroy(),At.remove(e.name)},t.loadAny=function(e,t,i,n){var r=bn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"default",e=Array.isArray(e)?e.slice():e;var u=zt.create({input:e,onProgress:a,onComplete:Sn(o),options:s});Kt.async(u)},t.preloadAny=function(e,t,i,n){var r=bn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=zt.create({input:e,onProgress:a,onComplete:Sn(o),options:s});qt.async(u)},t.loadRemote=function(e,t,i){var n=bn(t,void 0,i),r=n.options,s=n.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,i){t?(pe(t.message,t.stack),s&&s(t,i)):Jn.create(e,i,r.ext||ti(e),r,(function(e,t){s&&s(e,t)}))}))):Sn(s)(null,this.assets.get(e))},t.loadBundle=function(e,t,i){var n=bn(t,void 0,i),r=n.options,s=n.onComplete,a=Dt(e);this.bundles.has(a)?Sn(s)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,i){t?(pe(t.message,t.stack),s&&s(t,i)):Jn.create(e,i,"bundle",r,(function(e,t){s&&s(e,t)}))})))},t.releaseAsset=function(e){pn.tryRelease(e,!0)},t.releaseUnusedAssets=function(){pt.forEach((function(e){pn.tryRelease(e)}))},t.releaseAll=function(){pt.forEach((function(e){pn.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},ke(e,[{key:"main",get:function(){return At.get(Ut.MAIN)||null}},{key:"resources",get:function(){return At.get(Ut.RESOURCES)||null}}]),e}());hr.Pipeline=Qt,hr.Task=zt,hr.Cache=ht,hr.RequestItem=ar,hr.Bundle=Nn,hr.BuiltinBundleName=Ut;var lr=e("e",_e.assetManager=new hr);_e.AssetManager=hr;var dr=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],fr=[".mp3",".ogg",".wav",".m4a"];function pr(){return!0}var mr={transformURL:function(e){var t=oi(e);if(!t)return e;var i=At.find((function(e){return!!e.getAssetInfo(t)}));if(!i)return e;var n,r=i.getAssetInfo(t);if(!(n=e.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(n))return e;var s=!1;if(".ttf"===ti(e)&&(s=!0),s){var a=ui(e),o=Dt(e);e=a+"."+n+"/"+o}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+n}));return e}},_r=e("C",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=An}var t=e.prototype;return t.load=function(e,t,i){void 0===i&&void 0!==t&&(i=t,t=null);for(var n=Array.isArray(e)?e:[e],r=0;r<n.length;r++){var s=n[r];"string"==typeof s?n[r]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var a=[],o=[];lr.loadAny(n,null,(function(e,i,n){n.content&&(dr.includes(n.ext)?a.push(n.content):fr.includes(n.ext)&&o.push(n.content)),t&&t(e,i,n)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var s=function(e){var i=t[e];if(!(i instanceof _t)){var r=i,s=n[e].url;a.includes(r)?Jn.create(s,i,".png",{},(function(i,n){r=t[e]=n})):o.includes(r)&&Jn.create(s,i,".mp3",{},(function(i,n){r=t[e]=n})),pt.add(s,r)}},u=0;u<t.length;u++)s(u);if(t.length>1){var c=Object.create(null);t.forEach((function(e){c[e._uuid]=e})),r={isCompleted:pr,_map:c}}else r=t[0]}i&&i(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return lr.assets.has(e)?{content:lr.assets.get(e)}:null},t.loadRes=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete,u=ti(e);u&&!xn.getInfoWithPath(e,s)&&(e=e.slice(0,-u.length)),xn.load(e,s,a,o)},t.loadResArray=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;e.forEach((function(t,i){var n=ti(t);n&&!xn.getInfoWithPath(t,s)&&(e[i]=t.slice(0,-n.length))})),xn.load(e,s,a,o)},t.loadResDir=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;xn.loadDir(e,s,a,(function(t,i){var n=[];t||(n=xn.getDirWithPath(e,s).map((function(e){return e.path}))),o&&o(t,i,n)}))},t.getRes=function(e,t){return pt.has(e)?pt.get(e):xn.get(e,t)},t.getResCount=function(){return pt.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return mt.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({url:e},i)}};for(var n in e)i(n);jn.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({content:e},i)}};for(var n in e)i(n);ir.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];"string"==typeof i&&(i=pt.get(i)),lr.releaseAsset(i)}else e&&("string"==typeof e&&(e=pt.get(e)),lr.releaseAsset(e))},t.releaseAsset=function(e){lr.releaseAsset(e)},t.releaseRes=function(e,t){xn.release(e,t)},t.releaseAll=function(){lr.releaseAll(),pt.clear()},t.removeItem=function(e){return!!pt.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var i=mt.getDepsRecursively(e),n=0;n<i.length;n++)this._autoReleaseSetting[i[n]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},ke(e,[{key:"onProgress",set:function(e){mn=e}},{key:"_cache",get:function(){return pt._map}},{key:"md5Pipe",get:function(){return mr}},{key:"downloader",get:function(){return jn}},{key:"loader",get:function(){return lr.parser}}]),e}()),gr=e("l",new _r),vr=e("f",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,lr.init(e),e.rawAssets&&xn.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Ut.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets),extensionMap:{}})},loadAsset:function(e,t){lr.loadAny(e,t)}}),yr=e("u",{});ot(yr,"url",[{name:"normalize",target:lr.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Ht({path:si(e.substr(10)),bundle:Ut.RESOURCES,__isNative__:!0,ext:ti(e)}):""}}]),ut(vr,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),ut(gr,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),ot(_e,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return gr}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return vr}},{name:"Pipeline",target:hr,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return yr}}]),ut(_e,"cc",[{name:"LoadingItems",suggest:St(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),ot(ai,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:jn,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),ot(an,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return lr.main?null===(t=lr.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),ot(Ci,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return lr.main&&lr.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var wr,Tr,br,Ar,Er,Sr,Nr,xr,Rr,Ir,Pr,kr,Cr,Dr,Mr=pn._autoRelease;pn._autoRelease=function(e,t,i){Mr.call(pn,e,t,i);for(var n=gr._autoReleaseSetting,r=Object.keys(n),s=0;s<r.length;s++){var a=r[s];if(!0===n[a]){var o=pt.get(a);o&&pn.tryRelease(o)}}};var Fr,Br,Lr,Or,Ur,Wr,Vr=e("E",(wr=ci("cc.ClickEvent"),Tr=hi(_e.Node),br=mi(),Ar=mi(),Er=mi(),Sr=mi(),wr((Dr=function(){function e(){di(this,"target",Rr,this),di(this,"component",Ir,this),di(this,"_componentId",Pr,this),di(this,"handler",kr,this),di(this,"customEventData",Cr,this)}e.emitEvents=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var s=0,a=t.length;s<a;s++){var o=t[s];o instanceof e&&o.emit(n)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(_e.isValid(t)){this._genCompIdIfNeeded();var i=_e.js._getClassById(this._componentId),n=t.getComponent(i);if(_e.isValid(n)){var r=n[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(n,e))}}},t._compName2Id=function(e){var t=_e.js.getClassByName(e);return _e.js._getClassId(t)},t._compId2Name=function(e){var t=_e.js._getClassById(e);return _e.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},ke(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),Rr=li((xr=Dr).prototype,"target",[fi,Tr,br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ir=li(xr.prototype,"component",[fi,pi,Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Pr=li(xr.prototype,"_componentId",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),kr=li(xr.prototype,"handler",[fi,pi,Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Cr=li(xr.prototype,"customEventData",[fi,pi,Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Nr=xr))||Nr));_e.Component.EventHandler=Vr,ot(Li,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),ot(Li.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),_e.CameraComponent=Li,dt.setClassAlias(Li,"cc.CameraComponent");var jr,Hr,zr,qr,Gr,Xr,Yr,Qr,Jr,Kr,Zr=e("U",ci("cc.animation.UniformProxyFactory")((Wr=function(){function e(e,t){di(this,"passIndex",Lr,this),di(this,"uniformName",Or,this),di(this,"channelIndex",Ur,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],i=t.getHandle(this.uniformName);if(!i)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var n=_i.getPropertyTypeFromHandle(i);if(n===gi.BUFFER){var r=void 0===this.channelIndex?i:t.getHandle(this.uniformName,this.channelIndex,vi.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var i,n=ze(e.shaderInfo.blocks);!(i=n()).done;)for(var r,s=i.value,a=ze(s.members);!(r=a()).done;){var o=r.value;if(o.name===t)return o.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(n===gi.TEXTURE){var s=_i.getBindingFromHandle(i),a=t.properties[this.uniformName],o=a&&a.value?a.value+"-texture":yi(a.type),u=Qe.get(o);return u||(wi("Illegal texture default value: "+o+"."),u=Qe.get("default-texture")),{set:function(e){e||(e=u);var i=e.getGFXTexture();i&&i.width&&i.height&&(t.bindTexture(s,i),e instanceof Ti&&t.bindSampler(s,bi.getSampler(_e.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+n+".")},e}(),Lr=li((Br=Wr).prototype,"passIndex",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Or=li(Br.prototype,"uniformName",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ur=li(Br.prototype,"channelIndex",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Fr=Br))||Fr);e("M",ci("cc.animation.MorphWeightValueProxy")((Gr=function(){function e(){di(this,"subMeshIndex",zr,this),di(this,"shapeIndex",qr,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeight(i,t.subMeshIndex,t.shapeIndex)}}},e}(),zr=li((Hr=Gr).prototype,"subMeshIndex",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qr=li(Hr.prototype,"shapeIndex",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jr=Hr))||jr),e("a",ci("cc.animation.MorphWeightsValueProxy")((Jr=function(){function e(){di(this,"subMeshIndex",Qr,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeights(i,t.subMeshIndex)}}},e}(),Qr=li((Yr=Jr).prototype,"subMeshIndex",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xr=Yr))||Xr),e("b",ci("cc.animation.MorphWeightsAllValueProxy")(Kr=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var i,n,r=null!==(i=null===(n=e.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,s=0;s<r;++s)e.setWeights(t,s)}}},e}())||Kr),ot(Oi.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return Oi.prototype.removeState.call(this,e.name)}}]),_e.AnimationComponent=Oi,dt.setClassAlias(Oi,"cc.AnimationComponent");var $r,es,ts,is,ns,rs,ss,as=function(){function e(){this._nodeBlendStates=new Map}var t=e.prototype;return t.createWriter=function(e,t,i,n){var r=this.ref(e,t);return new os(e,t,r,i,n)},t.destroyWriter=function(e){var t=e;this.deRef(t.node,t.property)},t.ref=function(e,t){var i=this._nodeBlendStates.get(e);return i||(i=new ls,this._nodeBlendStates.set(e,i)),i.refProperty(t)},t.deRef=function(e,t){var i=this._nodeBlendStates.get(e);i&&(i.deRefProperty(t),i.empty&&this._nodeBlendStates.delete(e))},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){e.apply(t)}))},e}(),os=function(){function e(e,t,i,n,r){this._node=e,this._property=t,this._propertyBlendState=i,this._host=n,this._constants=r}var t=e.prototype;return t.getValue=function(){return this._node[this._property]},t.setValue=function(e){var t=this._propertyBlendState,i=this._host.weight;t.blend(e,i)},ke(e,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),e}(),us=function(e){this.blendedWeight=0,this.blendedValue=void 0,this.refCount=0,this.blendedValue=e},cs=function(e){function t(){return e.call(this,new s)||this}Be(t,e);var i=t.prototype;return i.blend=function(e,t){var i=this.blendedValue;1===t?s.copy(i,e):s.scaleAndAdd(i,i,e,t),this.blendedWeight+=t},i.reset=function(){this.blendedWeight=0,s.zero(this.blendedValue)},t}(us),hs=function(e){function t(){return e.call(this,new c)||this}Be(t,e);var i=t.prototype;return i.blend=function(e,t){if(0!==t){var i=this.blendedValue,n=this.blendedWeight;if(1===t)c.copy(i,e);else{var r=t/(n+t);c.slerp(i,i,e,r)}this.blendedWeight+=t}},i.reset=function(){this.blendedWeight=0,c.identity(this.blendedValue)},t}(us),ls=function(){function e(){this._properties={}}var t=e.prototype;return t.refProperty=function(e){var t,i,n,r=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":n=null!==(t=r[e])&&void 0!==t?t:r[e]=new cs;break;case"rotation":n=null!==(i=r[e])&&void 0!==i?i:r[e]=new hs}return++n.refCount,n},t.deRefProperty=function(e){var t=this._properties,i=t[e];i&&(--i.refCount,i.refCount>0||delete t[e])},t.apply=function(e){var t,i,n,r=this._properties,s=r.position,a=r.scale,o=r.rotation,u=r.eulerAngles,c=!1,h=!1,l=!1,d=!1;s&&s.blendedWeight&&(c=!0,s.blendedWeight<1&&s.blend(e.position,1-s.blendedWeight),t=s.blendedValue),a&&a.blendedWeight&&(h=!0,a.blendedWeight<1&&a.blend(e.scale,1-a.blendedWeight),i=a.blendedValue),u&&u.blendedWeight&&(d=!0,u.blendedWeight<1&&u.blend(e.eulerAngles,1-u.blendedWeight),n=u.blendedValue),o&&o.blendedWeight&&(l=!0,o.blendedWeight<1&&o.blend(e.rotation,1-o.blendedWeight),n=o.blendedValue),(n||t||i)&&e.setRTS(n,t,i),c&&s.reset(),h&&a.reset(),l&&o.reset(),d&&u.reset()},ke(e,[{key:"empty",get:function(){var e=this._properties;return!(e.position||e.rotation||e.eulerAngles||e.scale)}}]),e}(),ds=e("q",ci((ts=es=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._anims=new Ei([]),t._crossFades=new Ei([]),t._delayEvents=[],t._blendStateBuffer=new as,t._sockets=[],t}Be(t,e);var i=t.prototype;return i.addCrossFade=function(e){-1===this._crossFades.array.indexOf(e)&&this._crossFades.push(e)},i.removeCrossFade=function(e){var t=this._crossFades.array.indexOf(e);t>=0?this._crossFades.fastRemoveAt(t):Oe(3907)},i.update=function(e){var t=this._delayEvents,i=this._crossFades,n=this._sockets,r=i.array;for(i.i=0;i.i<r.length;++i.i)r[i.i].update(e);var s=this._anims,a=s.array;for(s.i=0;s.i<a.length;++s.i){var o=a[s.i];o.isMotionless||o.update(e)}this._blendStateBuffer.apply();for(var u=_e.director.getTotalFrames(),c=0,h=n.length;c<h;c++){var l=n[c],d=l.target,f=l.transform;d.matrix=Ui(f,u)}for(var p=0,m=t.length;p<m;p++){var _=t[p];_.fn.apply(_.thisArg,_.args)}t.length=0},i.destruct=function(){},i.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},i.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):Oe(3907)},i.pushDelayEvent=function(e,t,i){this._delayEvents.push({fn:e,thisArg:t,args:i})},i.addSockets=function(e,t){for(var i=this,n=function(n){var r=t[n];if(i._sockets.find((function(e){return e.target===r.target})))return"continue";var s=e.getChildByPath(r.path),a=r.target&&s&&Vi(s,e);a&&i._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)n(r)},i.removeSockets=function(e,t){for(var i=0;i<t.length;++i)for(var n=t[i],r=0;r<this._sockets.length;++r){var s=this._sockets[r];if(s.target===n.target){Wi(s.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},ke(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(Qi),es.ID="animation",$r=ts))||$r);an.on(sn.EVENT_INIT,(function(){var e=new ds;an.registerSystem(ds.ID,e,Qi.Priority.HIGH)})),_e.AnimationManager=ds,_e.easing=Si;var fs=e("H",ci("cc.HierachyModifier")(is=function(e){function t(){return e.apply(this,arguments)||this}return Be(t,e),t}(ji))||is);_e.HierachyModifier=fs;var ps=e("i",ci("cc.ComponentModifier")(ns=function(e){function t(){return e.apply(this,arguments)||this}return Be(t,e),t}(Hi))||ns);_e.ComponentModifier=ps;var ms=e("j",ci("cc.CurveValueAdapter")(rs=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||rs);_e.CurveValueAdapter=ms;var _s=e("k",ci("cc.UniformCurveValueAdapter")(ss=function(e){function t(){return e.apply(this,arguments)||this}return Be(t,e),t}(Zr))||ss);function gs(e){return"string"==typeof e}function vs(e){return"number"==typeof e}function ys(e,t){return e instanceof t}_e.UniformCurveValueAdapter=_s,_e.isPropertyModifier=gs,_e.isElementModifier=vs,_e.isCustomTargetModifier=ys,_e.math=zi,_e.geometry=qi}}}));
